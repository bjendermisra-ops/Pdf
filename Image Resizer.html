<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Resizer Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .dropzone {
        border: 2px dashed #ccc;
        transition: all 0.3s ease;
      }

      .dropzone.active {
        border-color: #4f46e5;
        background-color: #f0f0ff;
      }

      #previewImage {
        max-width: 100%;
        max-height: 60vh;
      }

      .ratio-lock {
        color: #4f46e5;
      }

      .ratio-lock.locked {
        color: white;
        background-color: #4f46e5;
      }

      .how-to-section {
        display: none;
      }
    </style>
  </head>

  <body class="bg-gray-50 min-h-screen">
    <?php include 'includes/navbar.html'; ?>
    <nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>
    <div class="container mx-auto px-4 py-8">
      <div
        class="max-w-3xl mx-auto bg-white rounded-xl shadow-md overflow-hidden"
      >
        <!-- Header Section -->
        <div class="bg-indigo-700 text-white p-6">
          <h1 class="text-2xl font-bold">Image Resizer Tool</h1>
          <p class="text-indigo-100">Resize JPG, PNG, GIF quickly and free</p>
        </div>

        <!-- Upload Section -->
        <div id="uploadSection" class="p-6 border-b">
          <div class="dropzone rounded-lg p-8 text-center cursor-pointer mb-6">
            <input type="file" id="fileInput" class="hidden" accept="image/*" />
            <div class="flex flex-col items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-indigo-500 mb-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                />
              </svg>
              <h3 class="text-lg font-medium text-gray-700 mb-1">
                Upload from PC or Mobile
              </h3>
              <p class="text-gray-500 text-sm mb-4">or Drag files here</p>
              <button
                id="uploadBtn"
                class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"
              >
                Select Image
              </button>
            </div>
          </div>
        </div>

        <!-- Preview Section -->
        <div id="previewSection" class="hidden p-6 border-b">
          <h2 class="text-xl font-medium text-gray-800 mb-4">Image Preview</h2>
          <div class="flex justify-center mb-4">
            <img id="previewImage" class="rounded-lg border" alt="Preview" />
          </div>
          <div class="text-center text-sm text-gray-500 mb-4">
            Original Dimensions: <span id="originalDimensions">0 × 0</span>
          </div>
        </div>

        <!-- How to Resize Section (shown after upload) -->
        <div id="howToSection" class="how-to-section p-6 border-b bg-gray-50">
          <h2 class="text-xl font-medium text-gray-800 mb-4">How to Resize</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-indigo-600 font-bold mb-2">
                1. Set Dimensions
              </div>
              <p class="text-gray-600">
                Enter your desired width and height in pixels
              </p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-indigo-600 font-bold mb-2">2. Aspect Ratio</div>
              <p class="text-gray-600">
                Lock to maintain proportions or enter custom values
              </p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow">
              <div class="text-indigo-600 font-bold mb-2">3. Resize</div>
              <p class="text-gray-600">
                Click the resize button to apply your changes
              </p>
            </div>
          </div>
        </div>

        <!-- Editor Section -->
        <div id="editorSection" class="hidden p-6 border-b">
          <h2 class="text-xl font-medium text-gray-800 mb-4">Resize Options</h2>
          <div class="bg-gray-100 p-4 rounded-lg mb-4">
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Width (px)</label
                >
                <input
                  type="number"
                  id="resizeWidth"
                  class="w-full px-3 py-2 border rounded-md"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Height (px)</label
                >
                <input
                  type="number"
                  id="resizeHeight"
                  class="w-full px-3 py-2 border rounded-md"
                />
              </div>
            </div>

            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <button
                  id="ratioLock"
                  class="ratio-lock rounded-l-md border border-gray-300 px-3 py-2 locked bg-indigo-600 text-white"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </button>
                <span
                  class="bg-gray-200 px-3 py-2 border-t border-b border-gray-300 text-sm"
                  >Maintain Ratio</span
                >
                <button
                  id="resetRatio"
                  class="bg-gray-200 rounded-r-md border border-gray-300 px-3 py-2 text-sm"
                >
                  Reset
                </button>
              </div>
              <button
                id="resizeBtn"
                class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"
              >
                Resize
              </button>
            </div>
          </div>

          <div class="text-center text-sm text-gray-500">
            New Dimensions: <span id="newDimensions">0 × 0</span>
          </div>
        </div>

        <!-- Result Section -->
        <div id="resultSection" class="hidden p-6">
          <h2 class="text-xl font-medium text-gray-800 mb-4">Resized Image</h2>
          <div class="flex justify-center mb-6">
            <img
              id="resultImage"
              class="rounded-lg border max-h-64"
              alt="Resized result"
            />
          </div>
          <div class="text-center">
            <button
              id="downloadBtn"
              class="bg-indigo-600 text-white px-6 py-3 rounded-md hover:bg-indigo-700 transition mr-4"
            >
              Download
            </button>
            <button
              id="newImageBtn"
              class="bg-gray-200 text-gray-700 px-6 py-3 rounded-md hover:bg-gray-300 transition"
            >
              New Image
            </button>
          </div>
        </div>
      </div>
    </div>
    <?php include 'includes/footer.html'; ?>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("fileInput");
        const uploadBtn = document.getElementById("uploadBtn");
        const dropzone = document.querySelector(".dropzone");
        const uploadSection = document.getElementById("uploadSection");
        const previewSection = document.getElementById("previewSection");
        const howToSection = document.getElementById("howToSection");
        const editorSection = document.getElementById("editorSection");
        const resultSection = document.getElementById("resultSection");
        const previewImage = document.getElementById("previewImage");
        const resultImage = document.getElementById("resultImage");
        const resizeWidth = document.getElementById("resizeWidth");
        const resizeHeight = document.getElementById("resizeHeight");
        const ratioLock = document.getElementById("ratioLock");
        const resetRatio = document.getElementById("resetRatio");
        const resizeBtn = document.getElementById("resizeBtn");
        const downloadBtn = document.getElementById("downloadBtn");
        const newImageBtn = document.getElementById("newImageBtn");
        const originalDimensions =
          document.getElementById("originalDimensions");
        const newDimensions = document.getElementById("newDimensions");

        let originalImage = null;
        let originalAspectRatio = 1;
        let maintainRatio = true;

        // Initialize
        uploadBtn.addEventListener("click", () => fileInput.click());
        fileInput.addEventListener("change", handleFileSelect);

        // Drag and drop handlers
        ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
          dropzone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ["dragenter", "dragover"].forEach((eventName) => {
          dropzone.addEventListener(eventName, highlight, false);
        });

        ["dragleave", "drop"].forEach((eventName) => {
          dropzone.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
          dropzone.classList.add("active");
        }

        function unhighlight() {
          dropzone.classList.remove("active");
        }

        dropzone.addEventListener("drop", handleDrop, false);

        function handleDrop(e) {
          const dt = e.dataTransfer;
          const files = dt.files;

          if (files.length) {
            fileInput.files = files;
            handleFileSelect({ target: fileInput });
          }
        }

        function handleFileSelect(event) {
          const file = event.target.files[0];
          if (!file) return;

          if (!file.type.match("image.*")) {
            alert("Please select an image file (JPG, PNG, GIF).");
            return;
          }

          const reader = new FileReader();

          reader.onload = function (e) {
            originalImage = new Image();
            originalImage.onload = function () {
              initializeEditor();
            };
            originalImage.src = e.target.result;
            previewImage.src = e.target.result;
          };

          uploadSection.classList.add("hidden");
          previewSection.classList.remove("hidden");
          howToSection.style.display = "block";
          editorSection.classList.remove("hidden");
          resultSection.classList.add("hidden");

          reader.readAsDataURL(file);
        }

        function initializeEditor() {
          // Set original dimensions
          originalAspectRatio = originalImage.width / originalImage.height;
          originalDimensions.textContent = `${originalImage.width} × ${originalImage.height}`;

          // Set default dimensions (50% of original)
          const defaultWidth = Math.round(originalImage.width / 2);
          const defaultHeight = Math.round(originalImage.height / 2);

          resizeWidth.value = defaultWidth;
          resizeHeight.value = defaultHeight;
          updateNewDimensions();

          // Set up event listeners
          resizeWidth.addEventListener("input", function () {
            if (maintainRatio && this.value && !isNaN(this.value)) {
              resizeHeight.value = Math.round(this.value / originalAspectRatio);
            }
            updateNewDimensions();
          });

          resizeHeight.addEventListener("input", function () {
            if (maintainRatio && this.value && !isNaN(this.value)) {
              resizeWidth.value = Math.round(this.value * originalAspectRatio);
            }
            updateNewDimensions();
          });

          ratioLock.addEventListener("click", function () {
            maintainRatio = !maintainRatio;
            this.classList.toggle("locked");
            this.classList.toggle("bg-indigo-600");
            this.classList.toggle("text-white");
          });

          resetRatio.addEventListener("click", function () {
            if (resizeWidth.value && !isNaN(resizeWidth.value)) {
              resizeHeight.value = Math.round(
                resizeWidth.value / originalAspectRatio
              );
              updateNewDimensions();
            }
          });
        }

        function updateNewDimensions() {
          const width = resizeWidth.value || 0;
          const height = resizeHeight.value || 0;
          newDimensions.textContent = `${width} × ${height}`;
        }

        // Resize button handler
        resizeBtn.addEventListener("click", function () {
          if (!originalImage) return;

          const width = parseInt(resizeWidth.value);
          const height = parseInt(resizeHeight.value);

          if (isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
            alert("Please enter valid dimensions (positive numbers)");
            return;
          }

          // Create canvas for resizing
          const canvas = document.createElement("canvas");
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext("2d");

          // Draw resized image
          ctx.drawImage(originalImage, 0, 0, width, height);

          // Show result
          resultImage.src = canvas.toDataURL("image/png");
          editorSection.classList.add("hidden");
          howToSection.style.display = "none";
          resultSection.classList.remove("hidden");
        });

        // Download button handler
        downloadBtn.addEventListener("click", function () {
          const link = document.createElement("a");
          link.download = "resized-image.png";
          link.href = resultImage.src;
          link.click();
        });

        // New image button handler
        newImageBtn.addEventListener("click", function () {
          uploadSection.classList.remove("hidden");
          previewSection.classList.add("hidden");
          howToSection.style.display = "none";
          editorSection.classList.add("hidden");
          resultSection.classList.add("hidden");
          fileInput.value = "";
          originalImage = null;
        });
      });
    </script>
  </body>
</html>
