<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#3B82F6",
              secondary: "#10B981",
              accent: "#6366F1",
              dark: "#1F2937",
              light: "#F9FAFB",
            },
          },
        },
      };
    </script>
    <style>
      .category-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
      }
      .expense-item {
        transition: all 0.2s ease;
      }
      .expense-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .chart-container {
        position: relative;
        height: 250px;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <nav>
      <a href="/" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to All Tools
      </a>
    </nav>

    <style>
      nav {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        padding: 1rem 1.5rem;
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .back-button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        border-radius: 9999px;
        color: white;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
      }

      .back-button i {
        font-size: 1rem;
      }

      .back-button:hover {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        transform: translateX(-0.25rem);
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
      }
    </style>
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <header class="text-center mb-12">
        <h1 class="text-3xl md:text-4xl font-bold text-primary mb-3">
          Expense Tracker
        </h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Track daily expenses and analyze your spending patterns
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Input Form and Summary -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold text-dark mb-6">
              Add New Expense
            </h2>

            <form id="expense-form" class="space-y-4">
              <div>
                <label
                  for="amount"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Amount (₹)</label
                >
                <input
                  type="number"
                  id="amount"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  placeholder="e.g., 500"
                  min="0"
                  step="0.01"
                  required
                />
              </div>

              <div>
                <label
                  for="description"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Description</label
                >
                <input
                  type="text"
                  id="description"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  placeholder="e.g., Groceries"
                  required
                />
              </div>

              <div>
                <label
                  for="category"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Category</label
                >
                <select
                  id="category"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  required
                >
                  <option value="food">Food & Dining</option>
                  <option value="transport">Transportation</option>
                  <option value="shopping">Shopping</option>
                  <option value="entertainment">Entertainment</option>
                  <option value="utilities">Utilities</option>
                  <option value="health">Health & Fitness</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <div>
                <label
                  for="date"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Date</label
                >
                <input
                  type="date"
                  id="date"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  required
                />
              </div>

              <button
                type="submit"
                class="w-full bg-primary text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
              >
                Add Expense
              </button>
            </form>
          </div>

          <!-- Summary Section -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold text-dark mb-6">
              Expense Summary
            </h2>

            <div class="space-y-4">
              <div class="flex justify-between items-center">
                <span class="text-gray-700">Total Expenses</span>
                <span id="total-expenses" class="text-xl font-bold text-primary"
                  >₹0</span
                >
              </div>

              <div class="flex justify-between items-center">
                <span class="text-gray-700">This Month</span>
                <span
                  id="month-expenses"
                  class="text-lg font-semibold text-blue-600"
                  >₹0</span
                >
              </div>

              <div class="flex justify-between items-center">
                <span class="text-gray-700">Today</span>
                <span
                  id="today-expenses"
                  class="text-lg font-semibold text-green-600"
                  >₹0</span
                >
              </div>

              <div class="pt-4 border-t border-gray-200">
                <h3 class="text-lg font-medium text-dark mb-3">By Category</h3>
                <div id="category-summary" class="space-y-2">
                  <!-- Category summary will be added here -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Expenses List and Charts -->
        <div class="lg:col-span-2">
          <!-- Filters -->
          <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <div
              class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
            >
              <h2 class="text-xl font-semibold text-dark">Expense History</h2>

              <div class="flex flex-wrap gap-2">
                <select
                  id="filter-category"
                  class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                >
                  <option value="all">All Categories</option>
                  <option value="food">Food & Dining</option>
                  <option value="transport">Transportation</option>
                  <option value="shopping">Shopping</option>
                  <option value="entertainment">Entertainment</option>
                  <option value="utilities">Utilities</option>
                  <option value="health">Health & Fitness</option>
                  <option value="other">Other</option>
                </select>

                <select
                  id="filter-time"
                  class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                >
                  <option value="all">All Time</option>
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>

                <button
                  id="clear-filters"
                  class="px-3 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
                >
                  Clear
                </button>
              </div>
            </div>
          </div>

          <!-- Expenses List -->
          <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <div id="expenses-list" class="space-y-3">
              <!-- Expense items will be added here -->
              <div class="text-center py-8 text-gray-500" id="empty-state">
                <i class="fas fa-receipt text-4xl mb-3"></i>
                <p>
                  No expenses recorded yet. Add your first expense to get
                  started.
                </p>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold text-dark mb-6">
              Spending Analysis
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <h3 class="text-lg font-medium text-dark mb-3">By Category</h3>
                <div class="chart-container">
                  <canvas id="category-chart"></canvas>
                </div>
              </div>

              <div>
                <h3 class="text-lg font-medium text-dark mb-3">Weekly Trend</h3>
                <div class="chart-container">
                  <canvas id="trend-chart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Expense Modal -->
    <div
      id="edit-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 mx-4">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Edit Expense</h2>

        <form id="edit-form" class="space-y-4">
          <input type="hidden" id="edit-id" />

          <div>
            <label
              for="edit-amount"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Amount (₹)</label
            >
            <input
              type="number"
              id="edit-amount"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              min="0"
              step="0.01"
              required
            />
          </div>

          <div>
            <label
              for="edit-description"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Description</label
            >
            <input
              type="text"
              id="edit-description"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              required
            />
          </div>

          <div>
            <label
              for="edit-category"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Category</label
            >
            <select
              id="edit-category"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              required
            >
              <option value="food">Food & Dining</option>
              <option value="transport">Transportation</option>
              <option value="shopping">Shopping</option>
              <option value="entertainment">Entertainment</option>
              <option value="utilities">Utilities</option>
              <option value="health">Health & Fitness</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div>
            <label
              for="edit-date"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Date</label
            >
            <input
              type="date"
              id="edit-date"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              required
            />
          </div>

          <div class="flex justify-between pt-4">
            <button
              type="button"
              id="cancel-edit"
              class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition"
            >
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // DOM Elements
      const expenseForm = document.getElementById("expense-form");
      const editForm = document.getElementById("edit-form");
      const expensesList = document.getElementById("expenses-list");
      const emptyState = document.getElementById("empty-state");
      const totalExpensesElement = document.getElementById("total-expenses");
      const monthExpensesElement = document.getElementById("month-expenses");
      const todayExpensesElement = document.getElementById("today-expenses");
      const categorySummaryElement =
        document.getElementById("category-summary");
      const filterCategory = document.getElementById("filter-category");
      const filterTime = document.getElementById("filter-time");
      const clearFiltersBtn = document.getElementById("clear-filters");
      const editModal = document.getElementById("edit-modal");
      const cancelEditBtn = document.getElementById("cancel-edit");

      // Chart instances
      let categoryChart = null;
      let trendChart = null;

      // Sample data for demonstration
      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

      // Initialize the app
      function initApp() {
        // Set today's date as default for the date input
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("date").value = today;

        // Render expenses
        renderExpenses();
        updateSummary();
        renderCharts();

        // Add event listeners
        expenseForm.addEventListener("submit", addExpense);
        editForm.addEventListener("submit", saveEditedExpense);
        filterCategory.addEventListener("change", renderExpenses);
        filterTime.addEventListener("change", renderExpenses);
        clearFiltersBtn.addEventListener("click", clearFilters);
        cancelEditBtn.addEventListener("click", closeEditModal);
      }

      // Add new expense
      function addExpense(e) {
        e.preventDefault();

        const amount = parseFloat(document.getElementById("amount").value);
        const description = document.getElementById("description").value;
        const category = document.getElementById("category").value;
        const date = document.getElementById("date").value;
        const id = Date.now().toString();

        const expense = {
          id,
          amount,
          description,
          category,
          date,
        };

        expenses.push(expense);
        saveToLocalStorage();
        renderExpenses();
        updateSummary();
        renderCharts();

        // Reset form
        expenseForm.reset();
        document.getElementById("date").value = new Date()
          .toISOString()
          .split("T")[0];
      }

      // Render expenses list
      function renderExpenses() {
        const categoryFilter = filterCategory.value;
        const timeFilter = filterTime.value;

        // Filter expenses
        let filteredExpenses = [...expenses];

        if (categoryFilter !== "all") {
          filteredExpenses = filteredExpenses.filter(
            (expense) => expense.category === categoryFilter
          );
        }

        if (timeFilter !== "all") {
          const now = new Date();
          filteredExpenses = filteredExpenses.filter((expense) => {
            const expenseDate = new Date(expense.date);

            if (timeFilter === "today") {
              return expenseDate.toDateString() === now.toDateString();
            } else if (timeFilter === "week") {
              const startOfWeek = new Date(now);
              startOfWeek.setDate(now.getDate() - now.getDay());
              startOfWeek.setHours(0, 0, 0, 0);

              return expenseDate >= startOfWeek;
            } else if (timeFilter === "month") {
              return (
                expenseDate.getMonth() === now.getMonth() &&
                expenseDate.getFullYear() === now.getFullYear()
              );
            }

            return true;
          });
        }

        // Sort by date (newest first)
        filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));

        // Render expenses
        if (filteredExpenses.length === 0) {
          expensesList.innerHTML = "";
          expensesList.appendChild(emptyState);
          emptyState.classList.remove("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        expensesList.innerHTML = "";

        filteredExpenses.forEach((expense) => {
          const expenseItem = document.createElement("div");
          expenseItem.className =
            "expense-item bg-white border border-gray-200 rounded-lg p-4";
          expenseItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-medium text-gray-800">${
                              expense.description
                            }</h3>
                            <div class="flex items-center mt-1">
                                <span class="text-gray-500 text-sm">${formatDate(
                                  expense.date
                                )}</span>
                                <span class="mx-2 text-gray-300">•</span>
                                <span class="category-badge bg-${getCategoryColor(
                                  expense.category
                                )}-100 text-${getCategoryColor(
            expense.category
          )}-800">${getCategoryName(expense.category)}</span>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg font-bold text-gray-800 mr-2">₹${expense.amount.toFixed(
                              2
                            )}</span>
                            <button class="edit-btn text-blue-500 hover:text-blue-700" data-id="${
                              expense.id
                            }">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-btn text-red-500 hover:text-red-700 ml-2" data-id="${
                              expense.id
                            }">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
          expensesList.appendChild(expenseItem);
        });

        // Add event listeners to edit and delete buttons
        document.querySelectorAll(".edit-btn").forEach((btn) => {
          btn.addEventListener("click", () => openEditModal(btn.dataset.id));
        });

        document.querySelectorAll(".delete-btn").forEach((btn) => {
          btn.addEventListener("click", () => deleteExpense(btn.dataset.id));
        });
      }

      // Update summary
      function updateSummary() {
        // Calculate total expenses
        const total = expenses.reduce(
          (sum, expense) => sum + expense.amount,
          0
        );
        totalExpensesElement.textContent = `₹${total.toFixed(2)}`;

        // Calculate this month's expenses
        const now = new Date();
        const monthExpenses = expenses
          .filter((expense) => {
            const expenseDate = new Date(expense.date);
            return (
              expenseDate.getMonth() === now.getMonth() &&
              expenseDate.getFullYear() === now.getFullYear()
            );
          })
          .reduce((sum, expense) => sum + expense.amount, 0);
        monthExpensesElement.textContent = `₹${monthExpenses.toFixed(2)}`;

        // Calculate today's expenses
        const todayExpenses = expenses
          .filter(
            (expense) =>
              new Date(expense.date).toDateString() === now.toDateString()
          )
          .reduce((sum, expense) => sum + expense.amount, 0);
        todayExpensesElement.textContent = `₹${todayExpenses.toFixed(2)}`;

        // Update category summary
        updateCategorySummary();
      }

      // Update category summary
      function updateCategorySummary() {
        const categoryTotals = {};

        // Calculate totals by category
        expenses.forEach((expense) => {
          if (!categoryTotals[expense.category]) {
            categoryTotals[expense.category] = 0;
          }
          categoryTotals[expense.category] += expense.amount;
        });

        // Render category summary
        categorySummaryElement.innerHTML = "";

        Object.entries(categoryTotals)
          .sort((a, b) => b[1] - a[1])
          .forEach(([category, total]) => {
            const categoryItem = document.createElement("div");
            categoryItem.className = "flex justify-between items-center";
            categoryItem.innerHTML = `
                        <div class="flex items-center">
                            <span class="category-badge bg-${getCategoryColor(
                              category
                            )}-100 text-${getCategoryColor(
              category
            )}-800 mr-2">${getCategoryName(category)}</span>
                        </div>
                        <span class="font-medium">₹${total.toFixed(2)}</span>
                    `;
            categorySummaryElement.appendChild(categoryItem);
          });
      }

      // Render charts
      function renderCharts() {
        renderCategoryChart();
        renderTrendChart();
      }

      // Render category chart
      function renderCategoryChart() {
        const ctx = document.getElementById("category-chart").getContext("2d");

        // Calculate totals by category
        const categoryTotals = {};
        expenses.forEach((expense) => {
          if (!categoryTotals[expense.category]) {
            categoryTotals[expense.category] = 0;
          }
          categoryTotals[expense.category] += expense.amount;
        });

        // Prepare data for chart
        const categories = Object.keys(categoryTotals);
        const amounts = Object.values(categoryTotals);
        const colors = categories.map((category) => getCategoryColor(category));

        // Destroy previous chart if it exists
        if (categoryChart) {
          categoryChart.destroy();
        }

        // Create new chart
        categoryChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: categories.map((category) => getCategoryName(category)),
            datasets: [
              {
                data: amounts,
                backgroundColor: [
                  "#3B82F6",
                  "#10B981",
                  "#6366F1",
                  "#F59E0B",
                  "#EF4444",
                  "#8B5CF6",
                  "#EC4899",
                ],
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  boxWidth: 12,
                  padding: 15,
                },
              },
            },
          },
        });
      }

      // Render trend chart
      function renderTrendChart() {
        const ctx = document.getElementById("trend-chart").getContext("2d");

        // Calculate weekly totals
        const weeklyTotals = {};
        const now = new Date();
        const startOfWeek = new Date(now);
        startOfWeek.setDate(now.getDate() - now.getDay());
        startOfWeek.setHours(0, 0, 0, 0);

        for (let i = 0; i < 7; i++) {
          const date = new Date(startOfWeek);
          date.setDate(startOfWeek.getDate() + i);
          const dateString = date.toISOString().split("T")[0];
          weeklyTotals[dateString] = 0;
        }

        expenses.forEach((expense) => {
          const expenseDate = new Date(expense.date);
          if (expenseDate >= startOfWeek) {
            const dateString = expense.date;
            if (weeklyTotals[dateString] !== undefined) {
              weeklyTotals[dateString] += expense.amount;
            }
          }
        });

        // Prepare data for chart
        const days = Object.keys(weeklyTotals).sort();
        const amounts = days.map((day) => weeklyTotals[day]);
        const dayLabels = days.map((day) => {
          const date = new Date(day);
          return date.toLocaleDateString("en-US", { weekday: "short" });
        });

        // Destroy previous chart if it exists
        if (trendChart) {
          trendChart.destroy();
        }

        // Create new chart
        trendChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: dayLabels,
            datasets: [
              {
                label: "Daily Spending",
                data: amounts,
                backgroundColor: "#3B82F6",
                borderRadius: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  drawBorder: false,
                },
              },
              x: {
                grid: {
                  display: false,
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
            },
          },
        });
      }

      // Open edit modal
      function openEditModal(id) {
        const expense = expenses.find((exp) => exp.id === id);

        if (expense) {
          document.getElementById("edit-id").value = expense.id;
          document.getElementById("edit-amount").value = expense.amount;
          document.getElementById("edit-description").value =
            expense.description;
          document.getElementById("edit-category").value = expense.category;
          document.getElementById("edit-date").value = expense.date;

          editModal.classList.remove("hidden");
        }
      }

      // Close edit modal
      function closeEditModal() {
        editModal.classList.add("hidden");
      }

      // Save edited expense
      function saveEditedExpense(e) {
        e.preventDefault();

        const id = document.getElementById("edit-id").value;
        const amount = parseFloat(document.getElementById("edit-amount").value);
        const description = document.getElementById("edit-description").value;
        const category = document.getElementById("edit-category").value;
        const date = document.getElementById("edit-date").value;

        const index = expenses.findIndex((exp) => exp.id === id);

        if (index !== -1) {
          expenses[index] = {
            ...expenses[index],
            amount,
            description,
            category,
            date,
          };

          saveToLocalStorage();
          renderExpenses();
          updateSummary();
          renderCharts();
          closeEditModal();
        }
      }

      // Delete expense
      function deleteExpense(id) {
        if (confirm("Are you sure you want to delete this expense?")) {
          expenses = expenses.filter((exp) => exp.id !== id);
          saveToLocalStorage();
          renderExpenses();
          updateSummary();
          renderCharts();
        }
      }

      // Clear filters
      function clearFilters() {
        filterCategory.value = "all";
        filterTime.value = "all";
        renderExpenses();
      }

      // Save to localStorage
      function saveToLocalStorage() {
        localStorage.setItem("expenses", JSON.stringify(expenses));
      }

      // Helper function to format date
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      // Helper function to get category name
      function getCategoryName(category) {
        const categoryNames = {
          food: "Food & Dining",
          transport: "Transportation",
          shopping: "Shopping",
          entertainment: "Entertainment",
          utilities: "Utilities",
          health: "Health & Fitness",
          other: "Other",
        };

        return categoryNames[category] || "Other";
      }

      // Helper function to get category color
      function getCategoryColor(category) {
        const categoryColors = {
          food: "blue",
          transport: "green",
          shopping: "purple",
          entertainment: "yellow",
          utilities: "red",
          health: "pink",
          other: "gray",
        };

        return categoryColors[category] || "gray";
      }

      // Initialize the app
      initApp();
    </script>
  </body>
</html>