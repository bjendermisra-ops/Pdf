<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Remove Pages from PDF Tool</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- PDF.js CDN for preview -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <!-- PDFLib CDN for page removal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #fff;
        min-height: 100vh;
        overflow-x: hidden;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1.5rem;
      }
      .drop-zone {
        border: 3px dashed #93c5fd;
        border-radius: 16px;
        padding: 2.5rem;
        text-align: center;
        background: #eef2ff;
        transition: all 0.3s ease;
      }
      .drop-zone.dragover {
        border-color: #2563eb;
        background: #dbeafe;
        transform: scale(1.02);
      }
      .file-info {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 1rem;
        display: none;
      }
      .remove-box {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-top: 1.5rem;
        display: none;
      }
      .page-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 1rem;
        padding: 1rem 0;
        max-height: 400px;
        overflow-y: auto;
      }
      .page-item {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 0.5rem;
        text-align: center;
        transition: all 0.2s ease;
        position: relative;
      }
      .page-item:hover {
        border-color: #2563eb;
        transform: scale(1.05);
      }
      .page-item input:checked + .page-content {
        background: #fee2e2;
        border-color: #ef4444;
      }
      .page-content {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      canvas {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        background: #f3f4f6;
        margin-bottom: 0.5rem;
      }
      .page-number {
        font-size: 0.8rem;
        color: #4b5563;
        font-weight: 500;
      }
      .file-details {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      .file-detail {
        background: #f3f4f6;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.9rem;
      }
      .file-detail strong {
        color: #1f2937;
      }
      @media (max-width: 640px) {
        .container {
          padding: 1rem;
        }
        .drop-zone {
          padding: 1.5rem;
        }
        button {
          width: 100%;
          font-size: 0.875rem;
        }
        .remove-box,
        .file-info {
          padding: 1rem;
        }
        .page-list {
          grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1
        class="text-5xl font-extrabold text-center text-black mt-20 mb-4 sm:text-3xl"
      >
        Remove Pages from PDF
      </h1>
      <h3 class="text-xl text-center text-gray-600 mb-10 sm:text-xl">
        Customize Your Pdf by Removing Pages From Pdf
      </h3>

      <!-- Drop Zone -->
      <div class="drop-zone max-w-2xl mx-auto" id="dropZone">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-12 w-12 mx-auto text-gray-500 mb-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
          />
        </svg>
        <p class="text-gray-700 text-xl font-medium sm:text-base">
          Drop your PDF here or
        </p>
        <input type="file" id="pdfInput" accept=".pdf" class="hidden" />
        <button
          class="mt-4 px-6 py-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition text-base sm:text-sm shadow-md"
        >
          Select File
        </button>
      </div>

      <!-- File Information -->
      <div class="file-info max-w-3xl mx-auto" id="fileInfo">
        <div class="file-details">
          <div class="file-detail">
            <strong>File Name:</strong> <span id="fileName">-</span>
          </div>
          <div class="file-detail">
            <strong>File Size:</strong> <span id="fileSize">-</span>
          </div>
          <div class="file-detail">
            <strong>Total Pages:</strong> <span id="totalPages">-</span>
          </div>
        </div>
      </div>

      <!-- Remove Controls -->
      <div class="remove-box max-w-3xl mx-auto" id="removeBox">
        <div class="flex flex-col gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2"
              >Select Pages to Remove</label
            >
            <div id="pageList" class="page-list"></div>
          </div>
          <button
            id="removeBtn"
            class="px-6 py-3 bg-green-600 text-white rounded-full hover:bg-green-700 transition text-base sm:text-sm disabled:bg-gray-400 shadow-md"
          >
            Remove Selected Pages & Download
          </button>
          <p id="status" class="text-gray-600 mt-2 text-sm hidden">
            Processing...
          </p>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.worker.min.js";

        let selectedFile = null;
        let pdfDoc = null;
        const $dropZone = $("#dropZone");
        const $input = $("#pdfInput");
        const $fileInfo = $("#fileInfo");
        const $fileName = $("#fileName");
        const $fileSize = $("#fileSize");
        const $totalPages = $("#totalPages");
        const $removeBox = $("#removeBox");
        const $pageList = $("#pageList");
        const $status = $("#status");
        const $removeBtn = $("#removeBtn");

        // Setup drag and drop
        $dropZone.on({
          dragover: function (e) {
            e.preventDefault();
            $(this).addClass("dragover");
          },
          dragleave: function () {
            $(this).removeClass("dragover");
          },
          drop: function (e) {
            e.preventDefault();
            $(this).removeClass("dragover");
            const files = e.originalEvent.dataTransfer.files;
            if (files.length) {
              $input[0].files = files;
              handleFileSelection(files[0]);
            }
          },
        });

        $("#dropZone button").on("click", () => $input.click());

        $input.on("change", function () {
          if (this.files.length) {
            handleFileSelection(this.files[0]);
          }
        });

        async function handleFileSelection(file) {
          if (!file || file.type !== "application/pdf") {
            alert("Please select a valid PDF file");
            return;
          }

          selectedFile = file;
          $removeBtn.prop("disabled", true);
          $status.removeClass("hidden").text("Loading PDF...");

          // Show file information
          $fileName.text(file.name);
          $fileSize.text(formatFileSize(file.size));
          $fileInfo.slideDown(300);

          try {
            const arrayBuffer = await file.arrayBuffer();
            pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

            $totalPages.text(pdfDoc.numPages);
            await renderPagePreviews();

            $dropZone.slideUp(300);
            $removeBox.slideDown(300);
            $status.addClass("hidden");
          } catch (error) {
            console.error("Error loading PDF:", error);
            $status.text("Failed to load PDF: " + error.message);
            setTimeout(() => $status.addClass("hidden"), 3000);
          }
        }

        function formatFileSize(bytes) {
          if (bytes === 0) return "0 Bytes";
          const k = 1024;
          const sizes = ["Bytes", "KB", "MB", "GB"];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return (
            parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i]
          );
        }

        // Render page previews
        async function renderPagePreviews() {
          $pageList.empty();
          $status.removeClass("hidden").text("Generating page previews...");

          try {
            const numPages = pdfDoc.numPages;
            const previewPromises = [];

            // Create all preview promises
            for (let i = 1; i <= numPages; i++) {
              previewPromises.push(createPagePreview(i));
            }

            // Wait for all previews to complete
            const previews = await Promise.all(previewPromises);

            // Append all previews to the page list
            previews.forEach((preview) => {
              $pageList.append(preview);
            });

            $removeBtn.prop("disabled", false);
            $status.addClass("hidden");
          } catch (error) {
            console.error("Error generating previews:", error);
            $status.text("Error generating previews: " + error.message);
            setTimeout(() => $status.addClass("hidden"), 3000);
          }
        }

        // Create a single page preview
        async function createPagePreview(pageNumber) {
          try {
            const page = await pdfDoc.getPage(pageNumber);
            const viewport = page.getViewport({ scale: 0.5 }); // Reduced scale for thumbnails

            // Create canvas
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");
            canvas.width = viewport.width;
            canvas.height = viewport.height;

            // Render page to canvas
            await page.render({
              canvasContext: context,
              viewport: viewport,
            }).promise;

            // Create page item HTML
            return $(`
                        <div class="page-item">
                            <input type="checkbox" class="hidden" id="page-${pageNumber}" value="${pageNumber - 1}">
                            <label for="page-${pageNumber}" class="page-content block cursor-pointer">
                                ${canvas.outerHTML}
                                <span class="page-number">Page ${pageNumber}</span>
                            </label>
                        </div>
                    `);
          } catch (error) {
            console.error(`Error rendering page ${pageNumber}:`, error);
            // Return a placeholder if rendering fails
            return $(`
                        <div class="page-item">
                            <input type="checkbox" class="hidden" id="page-${pageNumber}" value="${pageNumber - 1}">
                            <label for="page-${pageNumber}" class="page-content block cursor-pointer">
                                <div style="width: 100%; height: 120px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; color: #6b7280;">
                                    Preview unavailable
                                </div>
                                <span class="page-number">Page ${pageNumber}</span>
                            </label>
                        </div>
                    `);
          }
        }

        // Remove selected pages and download
        $removeBtn.on("click", async function () {
          if (!selectedFile || !pdfDoc) {
            alert("Please upload a PDF first.");
            return;
          }

          const pagesToRemove = $pageList
            .find("input:checked")
            .map(function () {
              return parseInt($(this).val());
            })
            .get();

          if (pagesToRemove.length === 0) {
            alert("Please select at least one page to remove.");
            return;
          }

          if (pagesToRemove.length === pdfDoc.numPages) {
            alert(
              "You cannot remove all pages. Please keep at least one page."
            );
            return;
          }

          try {
            $(this).prop("disabled", true);
            $status.removeClass("hidden").text("Processing...");

            const arrayBuffer = await selectedFile.arrayBuffer();
            const sourceDoc = await PDFLib.PDFDocument.load(arrayBuffer);
            const newDoc = await PDFLib.PDFDocument.create();

            // Keep only pages not selected for removal
            const pagesToKeep = Array.from(
              { length: sourceDoc.getPageCount() },
              (_, i) => i
            ).filter((i) => !pagesToRemove.includes(i));

            // Copy pages to new document
            const pages = await newDoc.copyPages(sourceDoc, pagesToKeep);
            pages.forEach((page) => newDoc.addPage(page));

            // Save the new PDF
            const newBytes = await newDoc.save();

            // Trigger download
            const blob = new Blob([newBytes], { type: "application/pdf" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download =
              selectedFile.name.replace(".pdf", "") + "_modified.pdf";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            $status.text("Pages removed successfully!");
          } catch (error) {
            console.error("Error removing pages:", error);
            $status.text("Error: " + error.message);
          } finally {
            $(this).prop("disabled", false);
            setTimeout(() => $status.addClass("hidden"), 3000);
          }
        });
      });
    </script>
  </body>
</html>
