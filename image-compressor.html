<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Image Compressor</title>
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            min-height: 100vh;
        }
        .drop-zone {
            border: 2px dashed #93c5fd;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            background: #ffffff;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .drop-zone.dragover {
            border-color: #2563eb;
            background: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #6366f1);
            transition: width 0.3s ease;
        }
        .file-card {
            border-left: 4px solid #3b82f6;
            transition: all 0.3s ease;
        }
        .file-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .tooltip {
            position: relative;
        }
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #1e293b;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container  mx-auto p-6">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Advanced Image Compressor</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">Compress multiple images with customizable quality settings while maintaining optimal visual clarity.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
                <div class="drop-zone" id="dropZone">
                    <div class="flex flex-col items-center justify-center">
                        <i class="fas fa-image text-5xl text-blue-500 mb-4"></i>
                        <p class="text-lg text-gray-600 mb-2">Drag & Drop Images here</p>
                        <p class="text-sm text-gray-500 mb-4">or</p>
                        <input type="file" id="imageInput" accept="image/*" multiple class="hidden">
                        <button id="browseBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center">
                            <i class="fas fa-folder-open mr-2"></i> Browse Files
                        </button>
                        <p class="text-xs text-gray-500 mt-4">Supports JPEG, PNG, WEBP (Max 50MB each)</p>
                    </div>
                </div>

                <div class="mt-6 bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Compression Settings</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Compression Quality</label>
                            <div class="flex items-center space-x-4">
                                <button id="highQuality" class="quality-btn px-4 py-2 bg-blue-100   rounded-md active">High</button>
                                <button id="mediumQuality" class="quality-btn px-4 py-2 bg-blue-100   rounded-md">Medium</button>
                                <button id="lowQuality" class="quality-btn px-4 py-2 bg-blue-100   rounded-md">Low</button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Lower quality results in smaller file sizes</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Maximum Dimension (px)</label>
                            <input type="number" id="maxDimension" value="1920" min="100" max="5000" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200">
                            <p class="text-xs text-gray-500 mt-1">Images larger than this will be resized (maintains aspect ratio)</p>
                        </div>

                        <div class="flex items-center">
                            <input type="checkbox" id="removeExif" class="rounded text-blue-600">
                            <label for="removeExif" class="ml-2 text-sm text-gray-700">Remove EXIF data</label>
                            <div class="tooltip ml-1">
                                <i class="fas fa-info-circle text-gray-400"></i>
                                <span class="tooltip-text">Removes metadata like camera info and location</span>
                            </div>
                        </div>

                        <button id="compressBtn" class="mt-6 w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center justify-center hidden">
                            <i class="fas fa-compress-alt mr-2"></i> Compress Image(s)
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow p-6 h-full">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Uploaded Images</h3>
                    <div id="fileList" class="space-y-3">
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-cloud-upload-alt text-3xl mb-2"></i>
                            <p>No images uploaded yet</p>
                        </div>
                    </div>

                    <div id="compressionStats" class="mt-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Compression Results</h3>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Original Size:</span>
                                <span id="originalSize" class="font-medium">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Compressed Size:</span>
                                <span id="compressedSize" class="font-medium text-green-600">-</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Reduction:</span>
                                <span id="reductionPercent" class="font-medium text-blue-600">-</span>
                            </div>
                        </div>

                        <div id="progressContainer" class="mt-4 hidden">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600">Progress:</span>
                                <span id="progressPercent" class="font-medium">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>

                        <div id="downloadAllContainer" class="mt-6 hidden">
                            <button id="downloadAllBtn" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center">
                                <i class="fas fa-download mr-2"></i> Download All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elements
            const dropZone = document.getElementById('dropZone');
            const imageInput = document.getElementById('imageInput');
            const browseBtn = document.getElementById('browseBtn');
            const fileList = document.getElementById('fileList');
            const compressBtn = document.getElementById('compressBtn');
            const compressionStats = document.getElementById('compressionStats');
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');

            // Compression settings
            let quality = 'medium'; // high, medium, low
            let maxDimension = 1920;
            let removeExif = false;
            let files = [];
            let compressedFiles = [];

            // Quality settings
            const qualitySettings = {
                high: { quality: 0.9, scale: 1 },
                medium: { quality: 0.7, scale: 0.8 },
                low: { quality: 0.5, scale: 0.6 }
            };

            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, e => {
                    e.preventDefault();
                    e.stopPropagation();
                });
            });

            // Drag & drop styling
            dropZone.addEventListener('dragenter', () => dropZone.classList.add('dragover'));
            dropZone.addEventListener('dragover', () => dropZone.classList.add('dragover'));
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));

            // Drop handler
            dropZone.addEventListener('drop', e => {
                dropZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            // Browse button
            browseBtn.addEventListener('click', () => imageInput.click());

            // File input
            imageInput.addEventListener('change', () => {
                if (imageInput.files.length) {
                    handleFiles(imageInput.files);
                    imageInput.value = ''; // Reset input
                }
            });

            // Quality buttons
            document.querySelectorAll('.quality-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.quality-btn').forEach(b => b.classList.remove('active', 'bg-blue-600', 'text-white'));
                    btn.classList.add('active', 'bg-blue-600', 'text-white');
                    quality = btn.id.replace('Quality', '').toLowerCase();
                });
            });

            // Max dimension input
            document.getElementById('maxDimension').addEventListener('input', e => {
                maxDimension = parseInt(e.target.value) || 1920;
            });

            // Remove EXIF checkbox
            document.getElementById('removeExif').addEventListener('change', e => {
                removeExif = e.target.checked;
            });

            // Compress button
            compressBtn.addEventListener('click', compressAllFiles);

            // Handle uploaded files
            function handleFiles(newFiles) {
                const validFiles = Array.from(newFiles).filter(file => {
                    if (!file.type.startsWith('image/')) {
                        alert(`${file.name} is not an image`);
                        return false;
                    }
                    if (file.size > 50 * 1024 * 1024) {
                        alert(`${file.name} is over 50MB limit`);
                        return false;
                    }
                    return true;
                });

                if (validFiles.length === 0) return;

                files = [...files, ...validFiles];
                updateFileList();
                compressBtn.classList.remove('hidden');
            }

            // Update file list UI
            function updateFileList() {
                if (files.length === 0) {
                    fileList.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-cloud-upload-alt text-3xl mb-2"></i>
                            <p>No images uploaded yet</p>
                        </div>
                    `;
                    compressBtn.classList.add('hidden');
                    compressionStats.classList.add('hidden');
                    downloadAllContainer.classList.add('hidden');
                    return;
                }

                let html = '';
                files.forEach((file, index) => {
                    const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
                    html += `
                        <div class="file-card bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-image text-blue-500 text-xl mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-800 truncate" style="max-width: 180px;">${file.name}</p>
                                    <p class="text-xs text-gray-500">${fileSizeMB} MB</p>
                                </div>
                            </div>
                            <button class="delete-file text-red-500 hover:text-red-700" data-index="${index}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `;
                });

                fileList.innerHTML = html;

                // Add delete event listeners
                document.querySelectorAll('.delete-file').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const index = btn.dataset.index;
                        files.splice(index, 1);
                        updateFileList();
                    });
                });
            }

            // Compress all files
            async function compressAllFiles() {
                if (files.length === 0) return;

                compressBtn.disabled = true;
                compressBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Compressing...';
                progressContainer.classList.remove('hidden');
                progressFill.style.width = '0%';
                progressPercent.textContent = '0%';

                compressedFiles = [];
                let totalOriginalSize = 0;
                let totalCompressedSize = 0;

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    totalOriginalSize += file.size;

                    try {
                        // Update progress
                        const progress = ((i + 1) / files.length) * 100;
                        progressFill.style.width = `${progress}%`;
                        progressPercent.textContent = `${Math.round(progress)}%`;

                        // Compress image
                        const compressedBlob = await compressImage(file);

                        // Create download URL
                        const url = URL.createObjectURL(compressedBlob);
                        const compressedSize = compressedBlob.size;
                        totalCompressedSize += compressedSize;

                        compressedFiles.push({
                            name: file.name.replace(/\.[^/.]+$/, '') + '_compressed.jpg',
                            url: url,
                            originalSize: file.size,
                            compressedSize: compressedSize
                        });
                    } catch (error) {
                        console.error('Error compressing image:', error);
                        alert(`Failed to compress ${file.name}`);
                    }
                }

                // Update UI
                compressBtn.disabled = false;
                compressBtn.innerHTML = '<i class="fas fa-compress-alt mr-2"></i> Compress Image(s)';
                progressFill.style.width = '100%';
                progressPercent.textContent = '100%';

                // Show stats
                const reductionPercent = ((totalOriginalSize - totalCompressedSize) / totalOriginalSize * 100).toFixed(1);
                document.getElementById('originalSize').textContent = formatFileSize(totalOriginalSize);
                document.getElementById('compressedSize').textContent = formatFileSize(totalCompressedSize);
                document.getElementById('reductionPercent').textContent = `${reductionPercent}%`;

                compressionStats.classList.remove('hidden');
                document.getElementById('downloadAllContainer').classList.remove('hidden');

                updateFileListWithDownloadLinks();
            }

            // Compress single image
            async function compressImage(file) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    const reader = new FileReader();

                    reader.onload = e => {
                        img.src = e.target.result;
                    };

                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Calculate new dimensions
                        let { width, height } = img;
                        if (width > maxDimension || height > maxDimension) {
                            const ratio = Math.min(maxDimension / width, maxDimension / height);
                            width = Math.round(width * ratio);
                            height = Math.round(height * ratio);
                        }

                        // Apply quality settings
                        const settings = qualitySettings[quality];
                        canvas.width = width * settings.scale;
                        canvas.height = height * settings.scale;

                        // Draw image
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                        // Convert to blob
                        canvas.toBlob(blob => {
                            if (blob) {
                                resolve(blob);
                            } else {
                                reject(new Error('Failed to create blob'));
                            }
                        }, 'image/jpeg', settings.quality);
                    };

                    img.onerror = reject;
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            // Update file list with download links
            function updateFileListWithDownloadLinks() {
                let html = '';
                compressedFiles.forEach((file, index) => {
                    const originalSizeMB = (file.originalSize / (1024 * 1024)).toFixed(2);
                    const compressedSizeMB = (file.compressedSize / (1024 * 1024)).toFixed(2);
                    const reduction = ((file.originalSize - file.compressedSize) / file.originalSize * 100).toFixed(1);

                    html += `
                        <div class="file-card bg-white p-4 rounded-lg shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <i class="fas fa-image text-blue-500 text-xl mr-3"></i>
                                    <div>
                                        <p class="text-sm font-medium text-gray-800 truncate" style="max-width: 180px;">${file.name}</p>
                                        <div class="flex text-xs space-x-2">
                                            <span class="text-gray-500 line-through">${originalSizeMB} MB</span>
                                            <span class="text-green-600 font-medium">${compressedSizeMB} MB</span>
                                            <span class="text-blue-600">(${reduction}% smaller)</span>
                                        </div>
                                    </div>
                                </div>
                                <a href="${file.url}" download="${file.name}" class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 transition">
                                    <i class="fas fa-download mr-1"></i> Download
                                </a> 
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div class="bg-blue-600 h-1.5 rounded-full" style="width: ${100 - parseFloat(reduction)}%"></div>
                            </div>
                        </div>
                    `;
                });

                fileList.innerHTML = html;
            }

            // Download all compressed files
            downloadAllBtn.addEventListener('click', () => {
                compressedFiles.forEach(file => {
                    const link = document.createElement('a');
                    link.href = file.url;
                    link.download = file.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    setTimeout(() => URL.revokeObjectURL(file.url), 100);
                });
            });

            // Helper function to format file size
            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' bytes';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
                else return (bytes / 1048576).toFixed(2) + ' MB';
            }

            // Initialize high quality as active
            document.getElementById('highQuality').click();
        });
    </script>
</body>
</html>
