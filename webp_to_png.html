<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebP to PNG Converter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

  <style>
    .drop-zone-highlight {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }
  </style>
</head>

<?php include 'includes/navbar.html'; ?>
<nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>
<div class="w-full max-w-3xl bg-white rounded-lg shadow-md p-8 mx-auto mt-12 mb-12">
  <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
    WebP to PNG Converter
  </h1>

  <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-6 transition-colors duration-200"
    id="dropZone">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24"
      stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
    </svg>
    <p class="mt-2 text-gray-600">Drag & drop your WebP file here</p>
    <p class="text-sm text-gray-500 mt-1">or</p>
    <label for="fileInput"
      class="mt-2 inline-block px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition">
      Select File
    </label>
    <input type="file" id="fileInput" accept=".webp" class="hidden" />
  </div>

  <div id="previewContainer" class="hidden mb-6">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">Preview</h2>
    <div class="flex flex-col md:flex-row gap-4">
      <div class="flex-1">
        <h3 class="text-sm font-medium text-gray-600 mb-1">
          Original WebP
        </h3>
        <div class="border rounded-md p-2 bg-gray-50">
          <img id="originalPreview" class="max-h-64 mx-auto max-w-full" src="" alt="Original WebP preview" />
        </div>
        <p id="originalInfo" class="text-xs text-gray-500 mt-1"></p>
      </div>
      <div class="flex-1">
        <h3 class="text-sm font-medium text-gray-600 mb-1">
          Converted PNG
        </h3>
        <div class="border rounded-md p-2 bg-gray-50">
          <img id="convertedPreview" class="max-h-64 mx-auto max-w-full" src="" alt="Converted PNG preview" />
        </div>
        <p id="convertedInfo" class="text-xs text-gray-500 mt-1"></p>
      </div>
    </div>
  </div>

  <div class="flex justify-center gap-4">
    <button id="downloadBtn" class="px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition hidden">
      Download PNG
    </button>
    <button id="resetBtn" class="px-6 py-3 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition hidden">
      Convert Another
    </button>
  </div>

  <div class="mt-8 text-sm text-gray-600">
    <h2 class="font-medium mb-2">How to use:</h2>
    <ol class="list-decimal pl-5 space-y-1">
      <li>Select or drag & drop a WebP file</li>
      <li>Preview the original and converted images</li>
      <li>Download the PNG version</li>
    </ol>
    <p class="mt-3 text-xs text-gray-500">
      Note: Conversion happens in your browser. Your files are not uploaded
      to any server.
    </p>
  </div>
</div>
<?php include 'includes/footer.html'; ?>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const originalPreview = document.getElementById("originalPreview");
    const convertedPreview = document.getElementById("convertedPreview");
    const previewContainer = document.getElementById("previewContainer");
    const downloadBtn = document.getElementById("downloadBtn");
    const resetBtn = document.getElementById("resetBtn");
    const originalInfo = document.getElementById("originalInfo");
    const convertedInfo = document.getElementById("convertedInfo");

    let convertedUrl = null;
    let currentFile = null;

    // Handle file selection
    fileInput.addEventListener("change", handleFileSelect);

    // Drag and drop events
    ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
      dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ["dragenter", "dragover"].forEach((eventName) => {
      dropZone.addEventListener(eventName, highlight, false);
    });

    ["dragleave", "drop"].forEach((eventName) => {
      dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
      dropZone.classList.add("drop-zone-highlight");
    }

    function unhighlight() {
      dropZone.classList.remove("drop-zone-highlight");
    }

    dropZone.addEventListener("drop", handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;

      if (files.length) {
        fileInput.files = files;
        handleFileSelect({ target: fileInput });
      }
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      currentFile = file;

      if (!file) return;

      if (!file.name.match(/\.webp$/i)) {
        alert("Please select a WebP file.");
        return;
      }

      // Display original file info
      originalInfo.textContent = `File: ${file.name} (${formatFileSize(
        file.size
      )})`;

      // Read and display original image
      const reader = new FileReader();
      reader.onload = function (e) {
        originalPreview.src = e.target.result;

        // Create canvas for conversion
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");

          // Draw white background for transparent WebP files
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);

          // Convert to PNG
          canvas.toBlob(function (blob) {
            // Revoke previous URL if exists
            if (convertedUrl) {
              URL.revokeObjectURL(convertedUrl);
            }

            // Create new URL for the converted image
            convertedUrl = URL.createObjectURL(blob);
            convertedPreview.src = convertedUrl;

            // Display converted file info
            convertedInfo.textContent = `File: ${file.name.replace(
              /\.webp$/i,
              ".png"
            )} (${formatFileSize(blob.size)})`;

            // Show preview and buttons
            previewContainer.classList.remove("hidden");
            downloadBtn.classList.remove("hidden");
            resetBtn.classList.remove("hidden");

            // Set up download
            downloadBtn.onclick = function () {
              const a = document.createElement("a");
              a.href = convertedUrl;
              a.download = file.name.replace(/\.webp$/i, ".png");
              document.body.appendChild(a);
              a.click();
              setTimeout(() => {
                document.body.removeChild(a);
              }, 100);
            };

            // Set up reset
            resetBtn.onclick = resetConverter;
          }, "image/png");
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function resetConverter() {
      // Revoke object URLs
      if (convertedUrl) {
        URL.revokeObjectURL(convertedUrl);
        convertedUrl = null;
      }

      // Reset previews
      originalPreview.src = "";
      convertedPreview.src = "";

      // Reset file input
      fileInput.value = "";
      currentFile = null;

      // Hide elements
      previewContainer.classList.add("hidden");
      downloadBtn.classList.add("hidden");
      resetBtn.classList.add("hidden");

      // Clear info texts
      originalInfo.textContent = "";
      convertedInfo.textContent = "";
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return "0 Bytes";
      const k = 1024;
      const sizes = ["Bytes", "KB", "MB", "GB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return (
        parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i]
      );
    }

    // Clean up object URLs when leaving the page
    window.addEventListener("beforeunload", function () {
      if (convertedUrl) {
        URL.revokeObjectURL(convertedUrl);
      }
    });
  });
</script>
</body>

</html>