<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Page Numbers to PDF Tool</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- PDF.js CDN for preview -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <!-- PDFLib CDN for adding page numbers -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #fff;
        min-height: 100vh;
        overflow-x: hidden;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 1.5rem;
      }
      .drop-zone {
        border: 3px dashed #93c5fd;
        border-radius: 16px;
        padding: 2.5rem;
        text-align: center;
        background: #eef2ff;
        transition: all 0.3s ease;
      }
      .drop-zone.dragover {
        border-color: #2563eb;
        background: #dbeafe;
        transform: scale(1.02);
      }
      .pagenumber-box {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
      }
      canvas {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      @media (max-width: 640px) {
        .container {
          padding: 1rem;
        }
        .drop-zone {
          padding: 1.5rem;
        }
        button,
        select {
          width: 100%;
          font-size: 0.875rem;
        }
        .pagenumber-box {
          padding: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1
        class="text-5xl font-extrabold text-center text-black mt-10 mb-5 sm:text-3xl animate-fade-in"
      >
        Add Page Numbers to PDF
      </h1>
      <p class="text-center text-gray-500 mb-10 sm:text-base">
        Choose your PDF, select the page number style and position, then
        download your numbered file.
      </p>

      <!-- Drop Zone -->
      <div
        class="drop-zone max-w-3xl mx-auto"
        id="dropZone"
        style="min-height: 300px"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-12 w-12 mx-auto text-gray-500 mb-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
          />
        </svg>
        <p class="text-gray-700 text-xl font-medium sm:text-base">
          Drop your PDF here
        </p>
        <input type="file" id="pdfInput" accept=".pdf" class="hidden" />
        <button
          class="mt-5 px-6 py-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition text-base sm:text-sm shadow-md"
        >
          Select File
        </button>
        <p class="mt-4 text-gray-500 text-base">
          All processing happens locally in your browser.
        </p>
      </div>

      <!-- Page Number Controls -->
      <div
        class="pagenumber-box mt-8 hidden max-w-3xl mx-auto"
        id="pagenumberBox"
      >
        <div class="flex flex-col gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2"
              >Preview (First Page)</label
            >
            <canvas id="pdfCanvas" class="w-full"></canvas>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Position</label
              >
              <select
                id="position"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
              >
                <option value="bottom-right">Bottom Right</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="top-right">Top Right</option>
                <option value="top-left">Top Left</option>
                <option value="bottom-center">Bottom Center</option>
                <!-- Added option -->
                <option value="top-center">Top Center</option>
                <!-- Added option -->
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Font Size</label
              >
              <select
                id="fontSize"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
              >
                <option value="10">10px</option>
                <option value="12" selected>12px</option>
                <option value="14">14px</option>
                <option value="16">16px</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2"
                >Format</label
              >
              <select
                id="format"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
              >
                <option value="page">Page X</option>
                <option value="page-of">Page X of Y</option>
                <option value="number">X</option>
              </select>
            </div>
          </div>
          <button
            id="addNumbersBtn"
            class="px-6 py-3 bg-green-600 text-white rounded-full hover:bg-green-700 transition text-base sm:text-sm disabled:bg-gray-400 shadow-md"
          >
            Add Page Numbers & Download
          </button>
          <p id="status" class="text-gray-600 mt-2 text-sm hidden">
            Processing...
          </p>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        let selectedFile = null;
        let pdfDoc = null;
        const $dropZone = $("#dropZone");
        const $input = $("#pdfInput");
        const $pagenumberBox = $("#pagenumberBox");
        const $status = $("#status");
        const $canvas = $("#pdfCanvas");
        const ctx = $canvas[0].getContext("2d");

        // Setup drag and drop
        $dropZone.on({
          dragover: function (e) {
            e.preventDefault();
            $(this).addClass("dragover");
          },
          dragleave: function () {
            $(this).removeClass("dragover");
          },
          drop: function (e) {
            e.preventDefault();
            $(this).removeClass("dragover");
            const files = e.originalEvent.dataTransfer.files;
            if (files.length) {
              $input[0].files = files;
              $input.trigger("change");
            }
          },
        });

        $("#dropZone button").on("click", () => $input.click());

        $input.on("change", async function (e) {
          const file = this.files[0];
          if (file && file.type === "application/pdf") {
            selectedFile = file;
            $dropZone.slideUp(300);
            $pagenumberBox.removeClass("hidden").slideDown(300);
            await previewPDF(file);
          } else {
            alert("Please select a valid PDF file");
          }
        });

        // Preview PDF
        async function previewPDF(file) {
          const arrayBuffer = await file.arrayBuffer();
          try {
            pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            await renderPage(1); // Render first page as preview
          } catch (error) {
            console.error("Preview failed:", error);
            $canvas[0].width = 300;
            $canvas[0].height = 100;
            ctx.fillStyle = "#f3f4f6";
            ctx.fillRect(0, 0, 300, 100);
            ctx.fillStyle = "#6b7280";
            ctx.font = "16px Inter";
            ctx.textAlign = "center";
            ctx.fillText("Preview unavailable", 150, 50);
          }
        }

        // Render PDF page on canvas
        async function renderPage(pageNum) {
          const page = await pdfDoc.getPage(pageNum);
          const scale = 2; // Moderate quality for preview
          const viewport = page.getViewport({ scale });
          $canvas[0].width = viewport.width;
          $canvas[0].height = viewport.height;
          await page.render({
            canvasContext: ctx,
            viewport: viewport,
          }).promise;
        }

        // Add page numbers and download
        $("#addNumbersBtn").on("click", async function () {
          if (!selectedFile) {
            alert("Please upload a PDF first.");
            return;
          }

          try {
            $(this).prop("disabled", true);
            $status.removeClass("hidden").text("Adding page numbers...");

            const arrayBuffer = await selectedFile.arrayBuffer();
            const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

            const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
            const fontSize = parseInt($("#fontSize").val());
            const position = $("#position").val();
            const format = $("#format").val();
            const totalPages = pdfDoc.getPageCount();

            const pages = pdfDoc.getPages();
            pages.forEach((page, index) => {
              const { width, height } = page.getSize();
              const pageNum = index + 1;
              let text;
              switch (format) {
                case "page":
                  text = `Page ${pageNum}`;
                  break;
                case "page-of":
                  text = `Page ${pageNum} of ${totalPages}`;
                  break;
                case "number":
                  text = `${pageNum}`;
                  break;
              }

              let x, y;
              const margin = 40;
              switch (position) {
                case "top-left":
                  x = margin;
                  y = height - fontSize - margin;
                  break;
                case "top-right":
                  x = width - font.widthOfTextAtSize(text, fontSize) - margin;
                  y = height - fontSize - margin;
                  break;
                case "bottom-left":
                  x = margin;
                  y = margin;
                  break;
                case "bottom-right":
                  x = width - font.widthOfTextAtSize(text, fontSize) - margin;
                  y = margin;
                  break;
                case "top-center":
                  x = (width - font.widthOfTextAtSize(text, fontSize)) / 2;
                  y = height - fontSize - margin;
                  break;
                case "bottom-center":
                  x = (width - font.widthOfTextAtSize(text, fontSize)) / 2;
                  y = margin;
                  break;
              }

              page.drawText(text, {
                x: x,
                y: y,
                size: fontSize,
                font: font,
                color: PDFLib.rgb(0, 0, 0), // Black color
                opacity: 0.8,
              });
            });

            // Save the PDF with page numbers
            const numberedBytes = await pdfDoc.save({
              useObjectStreams: false,
            });

            // Trigger download
            const blob = new Blob([numberedBytes], { type: "application/pdf" });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.href = url;
            link.download = "numbered.pdf";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            $status.text("Page numbers added successfully!");
            console.log("PDF with page numbers downloaded");
          } catch (error) {
            console.error("Error adding page numbers:", error);
            alert("Failed to add page numbers: " + error.message);
            $status.text("Processing failed.");
          } finally {
            $(this).prop("disabled", false);
            setTimeout(() => $status.addClass("hidden"), 3000);
          }
        });
      });
    </script>
  </body>
</html>
