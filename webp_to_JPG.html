<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebP to JPG Converter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

</head>


<?php include 'includes/navbar.html'; ?>
<nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>
<div class="w-full max-w-3xl bg-white rounded-lg shadow-md p-8 mx-auto mt-12 mb-12">
  <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
    WebP to JPG Converter
  </h1>

  <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-6" id="dropZone">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24"
      stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
    </svg>
    <p class="mt-2 text-gray-600">Drag & drop your WebP file here</p>
    <p class="text-sm text-gray-500 mt-1">or</p>
    <label for="fileInput"
      class="mt-2 inline-block px-4 py-2 bg-blue-600 text-white rounded-md cursor-pointer hover:bg-blue-700 transition">
      Select File
    </label>
    <input type="file" id="fileInput" accept=".webp" class="hidden" />
  </div>

  <div id="previewContainer" class="hidden mb-6">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">Preview</h2>
    <div class="flex flex-col md:flex-row gap-4">
      <div class="flex-1">
        <h3 class="text-sm font-medium text-gray-600 mb-1">
          Original WebP
        </h3>
        <div class="border rounded-md p-2 bg-gray-50">
          <img id="originalPreview" class="max-h-64 mx-auto" src="" alt="Original WebP preview" />
        </div>
        <p id="originalInfo" class="text-xs text-gray-500 mt-1"></p>
      </div>
      <div class="flex-1">
        <h3 class="text-sm font-medium text-gray-600 mb-1">
          Converted JPG
        </h3>
        <div class="border rounded-md p-2 bg-gray-50">
          <img id="convertedPreview" class="max-h-64 mx-auto" src="" alt="Converted JPG preview" />
        </div>
        <p id="convertedInfo" class="text-xs text-gray-500 mt-1"></p>
      </div>
    </div>
  </div>

  <div class="flex justify-center">
    <button id="downloadBtn" class="px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition hidden">
      Download JPG
    </button>
  </div>
  <div class="mt-10 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-6 shadow-sm">
    <h2 class="font-semibold text-lg text-blue-700 flex items-center mb-3">
      <svg class="w-5 h-5 mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2l4-4"></path>
      </svg>
      How to use
    </h2>
    <ol class="list-decimal pl-6 space-y-2 text-gray-700">
      <li>
        <span class="font-medium text-blue-600">Select</span> or <span class="font-medium text-green-600">drag &
          drop</span> a WebP file
      </li>
      <li>
        <span class="font-medium text-blue-600">Preview</span> the original and converted images
      </li>
      <li>
        <span class="font-medium text-green-600">Download</span> the JPG version
      </li>
    </ol>
    <div class="mt-4 flex items-center text-xs text-gray-500">
      <svg class="w-4 h-4 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5">
        </path>
      </svg>
      Conversion happens in your browser. Your files are <span class="font-semibold text-green-600 ml-1">never
        uploaded</span> to any server.
    </div>
  </div></svg>
</div>
<?php include 'includes/footer.html'; ?>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.getElementById("fileInput");
    const dropZone = document.getElementById("dropZone");
    const originalPreview = document.getElementById("originalPreview");
    const convertedPreview = document.getElementById("convertedPreview");
    const previewContainer = document.getElementById("previewContainer");
    const downloadBtn = document.getElementById("downloadBtn");
    const originalInfo = document.getElementById("originalInfo");
    const convertedInfo = document.getElementById("convertedInfo");

    let convertedUrl = null;

    // Handle file selection
    fileInput.addEventListener("change", handleFileSelect);

    // Drag and drop events
    ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
      dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ["dragenter", "dragover"].forEach((eventName) => {
      dropZone.addEventListener(eventName, highlight, false);
    });

    ["dragleave", "drop"].forEach((eventName) => {
      dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
      dropZone.classList.add("border-blue-500", "bg-blue-50");
    }

    function unhighlight() {
      dropZone.classList.remove("border-blue-500", "bg-blue-50");
    }

    dropZone.addEventListener("drop", handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;

      if (files.length) {
        fileInput.files = files;
        handleFileSelect({ target: fileInput });
      }
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];

      if (!file) return;

      if (!file.name.match(/\.webp$/i)) {
        alert("Please select a WebP file.");
        return;
      }

      // Display original file info
      originalInfo.textContent = `File: ${file.name} (${formatFileSize(
        file.size
      )})`;

      // Read and display original image
      const reader = new FileReader();
      reader.onload = function (e) {
        originalPreview.src = e.target.result;

        // Create canvas for conversion
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);

          // Convert to JPG
          canvas.toBlob(
            function (blob) {
              // Revoke previous URL if exists
              if (convertedUrl) {
                URL.revokeObjectURL(convertedUrl);
              }

              // Create new URL for the converted image
              convertedUrl = URL.createObjectURL(blob);
              convertedPreview.src = convertedUrl;

              // Display converted file info
              convertedInfo.textContent = `File: ${file.name.replace(
                /\.webp$/i,
                ".jpg"
              )} (${formatFileSize(blob.size)})`;

              // Show preview and download button
              previewContainer.classList.remove("hidden");
              downloadBtn.classList.remove("hidden");

              // Set up download
              downloadBtn.onclick = function () {
                const a = document.createElement("a");
                a.href = convertedUrl;
                a.download = file.name.replace(/\.webp$/i, ".jpg");
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                  document.body.removeChild(a);
                }, 100);
              };
            },
            "image/jpeg",
            0.85
          ); // 85% quality
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return "0 Bytes";
      const k = 1024;
      const sizes = ["Bytes", "KB", "MB", "GB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return (
        parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i]
      );
    }

    // Clean up object URLs when leaving the page
    window.addEventListener("beforeunload", function () {
      if (convertedUrl) {
        URL.revokeObjectURL(convertedUrl);
      }
    });
  });
</script>
</body>

</html>