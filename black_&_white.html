<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Black & White Photo Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .dropzone {
        transition: all 0.3s ease;
      }

      .dropzone.active {
        border-color: #3b82f6;
        background-color: #f0f9ff;
      }
    </style>
  </head>

  <body class="bg-gray-100 min-h-screen">
    <?php include 'includes/navbar.html'; ?>
    <nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>
    <div class="container mx-auto px-4 py-8">
      <div
        class="max-w-lg mx-auto bg-white rounded-xl shadow-lg overflow-hidden"
      >
        <div class="p-6">
          <h1 class="text-2xl font-bold text-center text-gray-800 mb-4">
            Black & White Converter
          </h1>

          <!-- File Upload -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Upload Image</label
            >
            <div
              id="dropzone"
              class="dropzone border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-gray-400 transition-colors"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="mx-auto h-12 w-12 text-gray-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                />
              </svg>
              <p class="mt-2 text-sm text-gray-600">
                Drag & drop your image here, or click to select
              </p>
              <input
                type="file"
                id="fileInput"
                accept="image/*"
                class="hidden"
              />
            </div>
          </div>

          <!-- Controls -->
          <div class="mb-6 space-y-4">
            <div>
              <label
                for="contrast"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Contrast</label
              >
              <input
                type="range"
                id="contrast"
                min="0"
                max="200"
                value="100"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              />
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>Low</span>
                <span id="contrastValue">100%</span>
                <span>High</span>
              </div>
            </div>

            <div>
              <label
                for="brightness"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Brightness</label
              >
              <input
                type="range"
                id="brightness"
                min="0"
                max="200"
                value="100"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              />
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>Dark</span>
                <span id="brightnessValue">100%</span>
                <span>Bright</span>
              </div>
            </div>
          </div>

          <!-- Preview -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Preview</label
            >
            <div
              class="relative border border-gray-200 rounded-lg overflow-hidden bg-gray-50 flex items-center justify-center"
              style="height: 300px"
            >
              <p id="placeholderText" class="text-gray-400">
                Your black & white image will appear here
              </p>
              <canvas
                id="previewCanvas"
                class="hidden max-w-full max-h-full"
              ></canvas>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-3">
            <button
              id="convertBtn"
              class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              Convert to B&W
            </button>
            <button
              id="downloadBtn"
              class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              Download
            </button>
          </div>
        </div>
      </div>
    </div>
    <?php include 'includes/footer.html'; ?>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // DOM Elements
        const fileInput = document.getElementById("fileInput");
        const dropzone = document.getElementById("dropzone");
        const contrastSlider = document.getElementById("contrast");
        const contrastValue = document.getElementById("contrastValue");
        const brightnessSlider = document.getElementById("brightness");
        const brightnessValue = document.getElementById("brightnessValue");
        const convertBtn = document.getElementById("convertBtn");
        const downloadBtn = document.getElementById("downloadBtn");
        const previewCanvas = document.getElementById("previewCanvas");
        const ctx = previewCanvas.getContext("2d");
        const placeholderText = document.getElementById("placeholderText");

        // Variables
        let originalImage = null;
        let convertedImageData = null;

        // Event Listeners
        dropzone.addEventListener("click", () => fileInput.click());
        dropzone.addEventListener("dragover", handleDragOver);
        dropzone.addEventListener("dragleave", handleDragLeave);
        dropzone.addEventListener("drop", handleDrop);
        fileInput.addEventListener("change", handleFileSelect);
        contrastSlider.addEventListener("input", updateSliderValue);
        brightnessSlider.addEventListener("input", updateSliderValue);
        convertBtn.addEventListener("click", convertToBlackAndWhite);
        downloadBtn.addEventListener("click", downloadImage);

        // Update slider value displays
        function updateSliderValue(e) {
          if (e.target.id === "contrast") {
            contrastValue.textContent = `${e.target.value}%`;
          } else {
            brightnessValue.textContent = `${e.target.value}%`;
          }

          // If image is already converted, update it with new settings
          if (convertedImageData) {
            applyBlackAndWhite();
          }
        }

        // Handle drag over
        function handleDragOver(e) {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.add("active");
        }

        // Handle drag leave
        function handleDragLeave(e) {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.remove("active");
        }

        // Handle drop
        function handleDrop(e) {
          e.preventDefault();
          e.stopPropagation();
          dropzone.classList.remove("active");

          if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            handleFileSelect({ target: fileInput });
          }
        }

        // Handle file selection
        function handleFileSelect(e) {
          const file = e.target.files[0];
          if (!file) return;

          if (!file.type.match("image.*")) {
            alert("Please select an image file");
            return;
          }

          const reader = new FileReader();
          reader.onload = function (event) {
            originalImage = new Image();
            originalImage.onload = function () {
              // Set canvas dimensions
              previewCanvas.width = originalImage.width;
              previewCanvas.height = originalImage.height;

              // Draw original image
              ctx.drawImage(originalImage, 0, 0);

              // Enable convert button
              convertBtn.disabled = false;

              // Hide placeholder
              placeholderText.classList.add("hidden");
              previewCanvas.classList.remove("hidden");
            };
            originalImage.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }

        // Convert to black and white
        function convertToBlackAndWhite() {
          if (!originalImage) return;

          // Show loading state
          convertBtn.disabled = true;
          convertBtn.innerHTML =
            '<span class="inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white"></span> Processing...';

          // Use setTimeout to allow UI to update before heavy processing
          setTimeout(() => {
            applyBlackAndWhite();

            // Restore button state
            convertBtn.disabled = false;
            convertBtn.textContent = "Convert to B&W";

            // Enable download button
            downloadBtn.disabled = false;
          }, 50);
        }

        // Apply black and white filter
        function applyBlackAndWhite() {
          // Get image data
          ctx.drawImage(originalImage, 0, 0);
          const imageData = ctx.getImageData(
            0,
            0,
            previewCanvas.width,
            previewCanvas.height
          );
          const data = imageData.data;

          // Get adjustment values
          const contrast = parseInt(contrastSlider.value) / 100;
          const brightness = parseInt(brightnessSlider.value) / 100;

          // Apply black and white with adjustments
          for (let i = 0; i < data.length; i += 4) {
            // Convert to grayscale (luminosity method)
            const gray =
              0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];

            // Apply contrast
            let adjusted = ((gray / 255 - 0.5) * contrast + 0.5) * 255;

            // Apply brightness
            adjusted = adjusted * brightness;

            // Clamp values between 0-255
            adjusted = Math.max(0, Math.min(255, adjusted));

            // Set RGB values to grayscale
            data[i] = data[i + 1] = data[i + 2] = adjusted;
          }

          // Put the modified data back
          ctx.putImageData(imageData, 0, 0);

          // Store the converted image data
          convertedImageData = previewCanvas.toDataURL("image/png");
        }

        // Download image
        function downloadImage() {
          if (!convertedImageData) return;

          const link = document.createElement("a");
          link.download = "black-and-white-image.png";
          link.href = convertedImageData;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }
      });
    </script>
  </body>
</html>
