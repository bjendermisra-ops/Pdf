<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JPG to PDF Converter | ImageTools</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      }

      .dropzone {
        border: 2px dashed #3b82f6;
        transition: all 0.3s ease;
      }

      .dropzone.active {
        border-color: #10b981;
        background-color: #f0fdf4;
      }

      .image-preview:hover {
        transform: scale(1.02);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        transition: width 0.3s ease;
      }
    </style>
  </head>

  <body class="font-sans antialiased text-gray-800">
    <?php include 'includes/navbar.html'; ?>
    <nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="min-h-screen bg-gray-50">
      <div class="container mx-auto px-4 py-12">
        <!-- Header -->
        <div class="text-center mb-12">
          <h1 class="text-3xl md:text-4xl font-bold mb-4">
            JPG to PDF Converter
          </h1>
          <p class="text-lg text-gray-600 max-w-2xl mx-auto">
            Convert your JPG images to PDF documents quickly and easily. Drag
            and drop or select your files below.
          </p>
        </div>

        <!-- Converter Tool -->
        <div
          class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden"
        >
          <!-- Upload Section -->
          <div class="p-6 md:p-8">
            <div
              id="dropzone"
              class="dropzone rounded-lg p-8 text-center cursor-pointer"
            >
              <div class="flex flex-col items-center justify-center space-y-4">
                <div
                  class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center"
                >
                  <i class="fas fa-cloud-upload-alt text-blue-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-semibold">
                  Drag & Drop JPG Files Here
                </h3>
                <p class="text-gray-500">or</p>
                <label
                  for="fileInput"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 cursor-pointer"
                >
                  <i class="fas fa-folder-open mr-2"></i> Select Files
                </label>
                <input
                  id="fileInput"
                  type="file"
                  accept="image/jpeg,image/jpg"
                  multiple
                  class="hidden"
                />
                <p class="text-sm text-gray-500 mt-2">
                  Supports JPG, JPEG files (Max 20MB each)
                </p>
              </div>
            </div>
          </div>

          <!-- Options Section -->
          <div class="bg-gray-50 p-6 border-t border-gray-200">
            <h3 class="text-lg font-semibold mb-4">Conversion Options</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Page Size</label
                >
                <select
                  id="pageSize"
                  class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                >
                  <option value="a4">A4 (210 × 297 mm)</option>
                  <option value="letter">Letter (8.5 × 11 in)</option>
                  <option value="legal">Legal (8.5 × 14 in)</option>
                  <option value="fit">Fit to Image</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Orientation</label
                >
                <select
                  id="orientation"
                  class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                >
                  <option value="portrait">Portrait</option>
                  <option value="landscape">Landscape</option>
                  <option value="auto">Auto (Based on Image)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Margin (mm)</label
                >
                <input
                  id="margin"
                  type="number"
                  min="0"
                  max="50"
                  value="10"
                  class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                />
              </div>
            </div>
            <div class="mt-4 flex items-center">
              <input
                id="compressPdf"
                type="checkbox"
                class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
              />
              <label for="compressPdf" class="ml-2 block text-sm text-gray-700"
                >Compress PDF to reduce file size</label
              >
            </div>
          </div>

          <!-- Preview Section -->
          <div class="p-6 border-t border-gray-200">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold">Selected Images</h3>
              <div class="text-sm text-gray-500">
                <span id="fileCount">0</span> files selected
              </div>
            </div>

            <div
              id="imagePreviewContainer"
              class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"
            >
              <!-- Images will be added here dynamically -->
              <div id="emptyState" class="col-span-full text-center py-8">
                <i class="fas fa-images text-gray-300 text-4xl mb-3"></i>
                <p class="text-gray-500">No images selected yet</p>
              </div>
            </div>
          </div>

          <!-- Progress and Action Section -->
          <div class="bg-gray-50 p-6 border-t border-gray-200">
            <div id="progressContainer" class="hidden mb-4">
              <div class="flex justify-between text-sm text-gray-600 mb-1">
                <span>Conversion Progress</span>
                <span id="progressPercent">0%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div
                  id="progressBar"
                  class="progress-bar bg-blue-600 h-2.5 rounded-full"
                  style="width: 0%"
                ></div>
              </div>
            </div>

            <div
              class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3"
            >
              <button
                id="clearBtn"
                class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition hidden"
              >
                <i class="fas fa-trash-alt mr-2"></i> Clear All
              </button>
              <button
                id="convertBtn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
              >
                <i class="fas fa-file-pdf mr-2"></i> Convert to PDF
              </button>
            </div>
          </div>
        </div>

        <!-- How It Works Section -->
        <div
          class="max-w-4xl mx-auto mt-12 bg-white rounded-xl shadow-md overflow-hidden"
        >
          <div class="p-6 md:p-8">
            <h2 class="text-2xl font-bold mb-6">How to Convert JPG to PDF</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="text-center">
                <div
                  class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
                >
                  <span class="text-blue-600 text-2xl font-bold">1</span>
                </div>
                <h3 class="font-semibold mb-2">Upload JPG Files</h3>
                <p class="text-gray-600 text-sm">
                  Drag & drop or click to browse your JPG/JPEG images
                </p>
              </div>
              <div class="text-center">
                <div
                  class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
                >
                  <span class="text-blue-600 text-2xl font-bold">2</span>
                </div>
                <h3 class="font-semibold mb-2">Adjust Settings</h3>
                <p class="text-gray-600 text-sm">
                  Choose page size, orientation, and other options
                </p>
              </div>
              <div class="text-center">
                <div
                  class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
                >
                  <span class="text-blue-600 text-2xl font-bold">3</span>
                </div>
                <h3 class="font-semibold mb-2">Download PDF</h3>
                <p class="text-gray-600 text-sm">
                  Click convert and download your PDF file instantly
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <?php include 'includes/footer.html'; ?>

    <script>
      // Initialize jsPDF
      const { jsPDF } = window.jspdf;

      // DOM Elements
      const dropzone = document.getElementById("dropzone");
      const fileInput = document.getElementById("fileInput");
      const imagePreviewContainer = document.getElementById(
        "imagePreviewContainer"
      );
      const emptyState = document.getElementById("emptyState");
      const fileCount = document.getElementById("fileCount");
      const convertBtn = document.getElementById("convertBtn");
      const clearBtn = document.getElementById("clearBtn");
      const progressContainer = document.getElementById("progressContainer");
      const progressBar = document.getElementById("progressBar");
      const progressPercent = document.getElementById("progressPercent");

      // Store selected files
      let selectedFiles = [];

      // Event Listeners
      dropzone.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", handleFileSelect);

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropzone.addEventListener(eventName, preventDefaults, false);
      });

      ["dragenter", "dragover"].forEach((eventName) => {
        dropzone.addEventListener(eventName, highlight, false);
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropzone.addEventListener(eventName, unhighlight, false);
      });

      dropzone.addEventListener("drop", handleDrop, false);

      convertBtn.addEventListener("click", convertToPdf);
      clearBtn.addEventListener("click", clearAll);

      // Functions
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      function highlight() {
        dropzone.classList.add("active");
      }

      function unhighlight() {
        dropzone.classList.remove("active");
      }

      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
      }

      function handleFileSelect(e) {
        const files = e.target.files;
        handleFiles(files);
      }

      function handleFiles(files) {
        if (files.length === 0) return;

        // Filter only JPG/JPEG files
        const imageFiles = Array.from(files).filter(
          (file) => file.type === "image/jpeg" || file.type === "image/jpg"
        );

        if (imageFiles.length === 0) {
          alert("Please select only JPG/JPEG files.");
          return;
        }

        // Check file sizes
        const oversizedFiles = imageFiles.filter(
          (file) => file.size > 20 * 1024 * 1024
        );
        if (oversizedFiles.length > 0) {
          alert("Some files are larger than 20MB and will not be processed.");
        }

        // Add valid files to selection
        const validFiles = imageFiles.filter(
          (file) => file.size <= 20 * 1024 * 1024
        );
        selectedFiles = [...selectedFiles, ...validFiles];

        updateFileDisplay();
      }

      function updateFileDisplay() {
        if (selectedFiles.length === 0) {
          emptyState.classList.remove("hidden");
          convertBtn.disabled = true;
          clearBtn.classList.add("hidden");
          fileCount.textContent = "0";
          return;
        }

        emptyState.classList.add("hidden");
        convertBtn.disabled = false;
        clearBtn.classList.remove("hidden");
        fileCount.textContent = selectedFiles.length.toString();

        // Clear previous previews (except empty state)
        imagePreviewContainer
          .querySelectorAll(".image-preview-container")
          .forEach((el) => el.remove());

        // Create previews for all selected files
        selectedFiles.forEach((file, index) => {
          const reader = new FileReader();

          reader.onload = function (e) {
            const previewContainer = document.createElement("div");
            previewContainer.className =
              "image-preview-container relative group";

            const preview = document.createElement("div");
            preview.className =
              "image-preview bg-gray-100 rounded-lg overflow-hidden aspect-[4/3] flex items-center justify-center transition-transform";

            const img = document.createElement("img");
            img.src = e.target.result;
            img.className = "max-w-full max-h-full object-contain";
            img.alt = "Preview";

            const removeBtn = document.createElement("button");
            removeBtn.className =
              "absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity";
            removeBtn.innerHTML = '<i class="fas fa-times text-xs"></i>';
            removeBtn.onclick = () => removeFile(index);

            const fileName = document.createElement("div");
            fileName.className =
              "absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-2 truncate";
            fileName.textContent = file.name;

            preview.appendChild(img);
            previewContainer.appendChild(preview);
            previewContainer.appendChild(removeBtn);
            previewContainer.appendChild(fileName);

            imagePreviewContainer.appendChild(previewContainer);
          };

          reader.readAsDataURL(file);
        });
      }

      function removeFile(index) {
        selectedFiles.splice(index, 1);
        updateFileDisplay();
      }

      function clearAll() {
        selectedFiles = [];
        updateFileDisplay();
        fileInput.value = "";
      }

      async function convertToPdf() {
        if (selectedFiles.length === 0) return;

        // Show progress
        progressContainer.classList.remove("hidden");
        progressBar.style.width = "0%";
        progressPercent.textContent = "0%";
        convertBtn.disabled = true;

        // Get user settings
        const pageSize = document.getElementById("pageSize").value;
        const orientation = document.getElementById("orientation").value;
        const margin = parseInt(document.getElementById("margin").value);
        const compress = document.getElementById("compressPdf").checked;

        // Initialize PDF
        const pdf = new jsPDF();

        // Process each image
        for (let i = 0; i < selectedFiles.length; i++) {
          const file = selectedFiles[i];
          const reader = new FileReader();

          // Update progress
          const progress = Math.floor((i / selectedFiles.length) * 100);
          progressBar.style.width = `${progress}%`;
          progressPercent.textContent = `${progress}%`;

          await new Promise((resolve) => {
            reader.onload = async function (e) {
              const img = new Image();
              img.src = e.target.result;

              await new Promise((imgResolve) => {
                img.onload = function () {
                  // Determine page dimensions
                  let pageWidth, pageHeight;
                  let imgWidth = img.width;
                  let imgHeight = img.height;

                  // Calculate dimensions based on settings
                  if (pageSize === "fit") {
                    // Fit to image dimensions (in mm)
                    const pxToMm = 0.264583;
                    pageWidth = imgWidth * pxToMm;
                    pageHeight = imgHeight * pxToMm;
                  } else {
                    // Standard page sizes
                    if (pageSize === "a4") {
                      pageWidth = 210;
                      pageHeight = 297;
                    } else if (pageSize === "letter") {
                      pageWidth = 215.9;
                      pageHeight = 279.4;
                    } else if (pageSize === "legal") {
                      pageWidth = 215.9;
                      pageHeight = 355.6;
                    }

                    // Adjust for orientation
                    if (
                      orientation === "landscape" ||
                      (orientation === "auto" && imgWidth > imgHeight)
                    ) {
                      [pageWidth, pageHeight] = [pageHeight, pageWidth];
                    }

                    // Calculate scaling to fit image within margins
                    const maxWidth = pageWidth - margin * 2;
                    const maxHeight = pageHeight - margin * 2;
                    const ratio = Math.min(
                      maxWidth / imgWidth,
                      maxHeight / imgHeight
                    );
                    imgWidth *= ratio;
                    imgHeight *= ratio;
                  }

                  // Add page if not the first image
                  if (i > 0) {
                    pdf.addPage([pageWidth, pageHeight]);
                  } else {
                    // Set first page dimensions
                    pdf.internal.pageSize.width = pageWidth;
                    pdf.internal.pageSize.height = pageHeight;
                  }

                  // Calculate position to center image
                  const x = (pageWidth - imgWidth) / 2;
                  const y = (pageHeight - imgHeight) / 2;

                  // Add image to PDF
                  pdf.addImage(img, "JPEG", x, y, imgWidth, imgHeight);

                  imgResolve();
                };
              });

              resolve();
            };

            reader.readAsDataURL(file);
          });
        }

        // Complete progress
        progressBar.style.width = "100%";
        progressPercent.textContent = "100%";

        // Save PDF
        const fileName =
          selectedFiles.length === 1
            ? selectedFiles[0].name.replace(/\.[^/.]+$/, "") + ".pdf"
            : "converted_images.pdf";

        if (compress) {
          // Simple compression (jsPDF doesn't have built-in compression)
          pdf.save(fileName, { compression: true });
        } else {
          pdf.save(fileName);
        }

        // Reset after a delay
        setTimeout(() => {
          progressContainer.classList.add("hidden");
          convertBtn.disabled = false;
        }, 1000);
      }
    </script>
  </body>
</html>
