<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GIF to JPG Converter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

  <style>
    .shake {
      animation: shake 0.5s;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: translateX(-5px);
      }

      20%,
      40%,
      60%,
      80% {
        transform: translateX(5px);
      }
    }
  </style>
</head>

<?php include 'includes/navbar.html'; ?>
<nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>
<div class="bg-white rounded-xl shadow-lg w-full max-w-2xl overflow-hidden mx-auto mt-12 mb-12 p-6">
  <!-- Header -->
  <div class="bg-blue-600 p-4 text-white">
    <h1 class="text-xl font-bold">GIF to JPG Converter</h1>
    <p class="text-sm opacity-90">Convert your GIF images to JPG format</p>
  </div>

  <!-- Main Content -->
  <div class="p-6">
    <!-- Error Message -->
    <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"></div>

    <!-- Upload Area -->
    <div id="upload-area"
      class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors mb-6">
      <div class="flex flex-col items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mb-3" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <p class="text-gray-600 mb-1">Drag & drop your GIF file here</p>
        <p class="text-sm text-gray-500">or click to browse files</p>
      </div>
      <input type="file" id="file-input" class="hidden" accept="image/gif" />
    </div>

    <!-- Preview Section -->
    <div id="preview-section" class="hidden mb-6">
      <h3 class="font-medium text-gray-700 mb-2">Preview</h3>
      <div class="flex flex-col sm:flex-row gap-4">
        <div class="flex-1">
          <p class="text-sm text-gray-500 mb-1">Original GIF</p>
          <div class="border rounded-lg overflow-hidden">
            <img id="gif-preview" class="w-full h-auto max-h-40 object-contain" />
          </div>
        </div>
        <div class="flex-1">
          <p class="text-sm text-gray-500 mb-1">Converted JPG</p>
          <div class="border rounded-lg overflow-hidden">
            <canvas id="jpg-preview" class="w-full h-auto max-h-40 bg-gray-50"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Options -->
    <div class="mb-6">
      <h3 class="font-medium text-gray-700 mb-3">Options</h3>
      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <label for="quality" class="text-sm text-gray-600">Quality</label>
          <input type="range" id="quality" min="1" max="100" value="80" class="w-32" />
          <span id="quality-value" class="text-sm font-medium w-8 text-right">80</span>
        </div>
      </div>
    </div>

    <!-- Download Button -->
    <button id="download-btn"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-colors hidden">
      Download JPG
    </button>
  </div>
</div>
<?php include 'includes/footer.html'; ?>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const uploadArea = document.getElementById("upload-area");
    const fileInput = document.getElementById("file-input");
    const gifPreview = document.getElementById("gif-preview");
    const jpgPreview = document.getElementById("jpg-preview");
    const previewSection = document.getElementById("preview-section");
    const downloadBtn = document.getElementById("download-btn");
    const qualitySlider = document.getElementById("quality");
    const qualityValue = document.getElementById("quality-value");
    const errorMessage = document.getElementById("error-message");

    // Update quality value display
    qualitySlider.addEventListener("input", function () {
      qualityValue.textContent = this.value;
      if (gifPreview.src) {
        convertGifToJpg(gifPreview);
      }
    });

    // Handle drag and drop
    uploadArea.addEventListener("dragover", function (e) {
      e.preventDefault();
      this.classList.add("border-blue-500", "bg-blue-50");
    });

    uploadArea.addEventListener("dragleave", function () {
      this.classList.remove("border-blue-500", "bg-blue-50");
    });

    uploadArea.addEventListener("drop", function (e) {
      e.preventDefault();
      this.classList.remove("border-blue-500", "bg-blue-50");

      if (e.dataTransfer.files.length) {
        handleFile(e.dataTransfer.files[0]);
      }
    });

    // Handle click to browse
    uploadArea.addEventListener("click", function () {
      fileInput.click();
    });

    fileInput.addEventListener("change", function () {
      if (this.files.length) {
        handleFile(this.files[0]);
      }
    });

    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.remove("hidden");
      uploadArea.classList.add("shake");
      setTimeout(() => uploadArea.classList.remove("shake"), 500);
    }

    // Hide error message
    function hideError() {
      errorMessage.classList.add("hidden");
    }

    // Handle file processing
    function handleFile(file) {
      hideError();

      // Validate file type
      if (!file.type.match("image/gif")) {
        showError("Please select a valid GIF file.");
        return;
      }

      // Validate file size (max 5MB)
      if (file.size > 5 * 1024 * 1024) {
        showError("File size too large. Maximum 5MB allowed.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        gifPreview.onload = function () {
          try {
            convertGifToJpg(gifPreview);
            previewSection.classList.remove("hidden");
            downloadBtn.classList.remove("hidden");
          } catch (error) {
            showError(
              "Failed to process the GIF file. It might be corrupted."
            );
            console.error("Conversion error:", error);
          }
        };
        gifPreview.onerror = function () {
          showError("The selected file appears to be corrupted.");
        };
        gifPreview.src = e.target.result;
      };
      reader.onerror = function () {
        showError("Error reading the file.");
      };
      reader.readAsDataURL(file);
    }

    // Convert GIF to JPG
    function convertGifToJpg(imgElement) {
      try {
        const canvas = jpgPreview;
        const ctx = canvas.getContext("2d");

        // Set canvas dimensions to match image
        canvas.width = imgElement.naturalWidth || imgElement.width;
        canvas.height = imgElement.naturalHeight || imgElement.height;

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw image on canvas
        ctx.drawImage(imgElement, 0, 0, canvas.width, canvas.height);

        // Validate the canvas output
        if (canvas.width === 0 || canvas.height === 0) {
          throw new Error("Invalid image dimensions");
        }
      } catch (error) {
        showError("Failed to convert the image. Please try another file.");
        throw error;
      }
    }

    // Handle download
    downloadBtn.addEventListener("click", function () {
      try {
        const quality =
          Math.max(1, Math.min(100, parseInt(qualitySlider.value))) / 100;
        const dataUrl = jpgPreview.toDataURL("image/jpeg", quality);

        // Validate the data URL
        if (!dataUrl.startsWith("data:image/jpeg")) {
          throw new Error("Invalid image data");
        }

        const link = document.createElement("a");
        link.download = "converted_" + Date.now() + ".jpg";
        link.href = dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } catch (error) {
        showError("Failed to generate the JPG file. Please try again.");
        console.error("Download error:", error);
      }
    });
  });
</script>
</body>

</html>