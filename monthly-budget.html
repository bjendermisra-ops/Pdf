<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Budget Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#3B82F6",
              secondary: "#10B981",
              accent: "#6366F1",
              dark: "#1F2937",
              light: "#F9FAFB",
            },
          },
        },
      };
    </script>
    <style>
      .category-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
      }
      .budget-item {
        transition: all 0.2s ease;
      }
      .budget-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .chart-container {
        position: relative;
        height: 250px;
      }
      .progress-bar {
        transition: width 0.5s ease;
      }
      input[type="range"] {
        -webkit-appearance: none;
        height: 6px;
        border-radius: 5px;
        background: #e5e7eb;
        outline: none;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #3b82f6;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <nav>
      <a href="/" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to All Tools
      </a>
    </nav>

    <style>
      nav {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        padding: 1rem 1.5rem;
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .back-button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        border-radius: 9999px;
        color: white;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
      }

      .back-button i {
        font-size: 1rem;
      }

      .back-button:hover {
        background: linear-gradient(135deg, #1d4ed8, #1e40af);
        transform: translateX(-0.25rem);
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
      }
    </style>
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <header class="text-center mb-12">
        <h1 class="text-3xl md:text-4xl font-bold text-primary mb-3">
          Monthly Budget Planner
        </h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Plan and track your monthly income and expenses
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Input Form and Summary -->
        <div class="lg:col-span-1">
          <!-- Month Selector -->
          <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold text-dark mb-4">Select Month</h2>
            <div class="flex items-center space-x-4">
              <button
                id="prev-month"
                class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200"
              >
                <i class="fas fa-chevron-left"></i>
              </button>
              <span
                id="current-month"
                class="text-lg font-medium flex-1 text-center"
                >September 2023</span
              >
              <button
                id="next-month"
                class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200"
              >
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>

          <!-- Budget Summary -->
          <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold text-dark mb-6">Budget Summary</h2>

            <div class="space-y-4">
              <div class="flex justify-between items-center">
                <span class="text-gray-700">Total Income</span>
                <span id="total-income" class="text-xl font-bold text-green-600"
                  >₹0</span
                >
              </div>

              <div class="flex justify-between items-center">
                <span class="text-gray-700">Total Expenses</span>
                <span id="total-expenses" class="text-xl font-bold text-red-600"
                  >₹0</span
                >
              </div>

              <div class="pt-4 border-t border-gray-200">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-gray-700">Remaining Budget</span>
                  <span
                    id="remaining-budget"
                    class="text-xl font-bold text-blue-600"
                    >₹0</span
                  >
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div
                    id="budget-progress"
                    class="h-2.5 rounded-full progress-bar"
                    style="width: 0%"
                  ></div>
                </div>
                <div class="text-xs text-gray-500 mt-1" id="budget-status">
                  0% of income remaining
                </div>
              </div>
            </div>
          </div>

          <!-- Add Income/Expense Form -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold text-dark mb-6">Add New Item</h2>

            <form id="budget-form" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1"
                  >Type</label
                >
                <div class="flex space-x-4">
                  <label class="inline-flex items-center">
                    <input
                      type="radio"
                      name="type"
                      value="income"
                      class="text-primary focus:ring-primary"
                      checked
                    />
                    <span class="ml-2">Income</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input
                      type="radio"
                      name="type"
                      value="expense"
                      class="text-primary focus:ring-primary"
                    />
                    <span class="ml-2">Expense</span>
                  </label>
                </div>
              </div>

              <div>
                <label
                  for="amount"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Amount (₹)</label
                >
                <input
                  type="number"
                  id="amount"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  placeholder="e.g., 5000"
                  min="0"
                  step="0.01"
                  required
                />
              </div>

              <div>
                <label
                  for="description"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Description</label
                >
                <input
                  type="text"
                  id="description"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  placeholder="e.g., Salary, Rent, etc."
                  required
                />
              </div>

              <div>
                <label
                  for="category"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Category</label
                >
                <select
                  id="category"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  required
                >
                  <option value="" disabled selected>Select a category</option>
                  <!-- Income Categories -->
                  <optgroup label="Income" id="income-categories">
                    <option value="salary">Salary</option>
                    <option value="freelance">Freelance Work</option>
                    <option value="investment">Investment Returns</option>
                    <option value="gift">Gifts</option>
                    <option value="other-income">Other Income</option>
                  </optgroup>
                  <!-- Expense Categories -->
                  <optgroup label="Expenses" id="expense-categories">
                    <option value="housing">Housing</option>
                    <option value="utilities">Utilities</option>
                    <option value="food">Food & Dining</option>
                    <option value="transport">Transportation</option>
                    <option value="health">Health & Fitness</option>
                    <option value="entertainment">Entertainment</option>
                    <option value="shopping">Shopping</option>
                    <option value="debt">Debt Payments</option>
                    <option value="other-expense">Other Expenses</option>
                  </optgroup>
                </select>
              </div>

              <div>
                <label
                  for="date"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Date</label
                >
                <input
                  type="date"
                  id="date"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                  required
                />
              </div>

              <button
                type="submit"
                class="w-full bg-primary text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
              >
                Add Item
              </button>
            </form>
          </div>
        </div>

        <!-- Budget Details and Charts -->
        <div class="lg:col-span-2">
          <!-- Filters -->
          <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <div
              class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
            >
              <h2 class="text-xl font-semibold text-dark">Budget Details</h2>

              <div class="flex flex-wrap gap-2">
                <select
                  id="filter-type"
                  class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                >
                  <option value="all">All Items</option>
                  <option value="income">Income Only</option>
                  <option value="expense">Expenses Only</option>
                </select>

                <select
                  id="filter-category"
                  class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
                >
                  <option value="all">All Categories</option>
                  <!-- Categories will be populated dynamically -->
                </select>

                <button
                  id="clear-filters"
                  class="px-3 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
                >
                  Clear
                </button>
              </div>
            </div>
          </div>

          <!-- Budget Items List -->
          <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <div id="budget-items-list" class="space-y-3">
              <!-- Budget items will be added here -->
              <div class="text-center py-8 text-gray-500" id="empty-state">
                <i class="fas fa-wallet text-4xl mb-3"></i>
                <p>
                  No budget items recorded yet. Add your first income or expense
                  to get started.
                </p>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold text-dark mb-6">
              Budget Analysis
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <h3 class="text-lg font-medium text-dark mb-3">
                  Income vs Expenses
                </h3>
                <div class="chart-container">
                  <canvas id="comparison-chart"></canvas>
                </div>
              </div>

              <div>
                <h3 class="text-lg font-medium text-dark mb-3">
                  Expenses by Category
                </h3>
                <div class="chart-container">
                  <canvas id="expenses-chart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Budget Item Modal -->
    <div
      id="edit-modal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 mx-4">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Edit Budget Item</h2>

        <form id="edit-form" class="space-y-4">
          <input type="hidden" id="edit-id" />

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Type</label
            >
            <div class="flex space-x-4">
              <label class="inline-flex items-center">
                <input
                  type="radio"
                  name="edit-type"
                  value="income"
                  class="text-primary focus:ring-primary"
                />
                <span class="ml-2">Income</span>
              </label>
              <label class="inline-flex items-center">
                <input
                  type="radio"
                  name="edit-type"
                  value="expense"
                  class="text-primary focus:ring-primary"
                />
                <span class="ml-2">Expense</span>
              </label>
            </div>
          </div>

          <div>
            <label
              for="edit-amount"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Amount (₹)</label
            >
            <input
              type="number"
              id="edit-amount"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              min="0"
              step="0.01"
              required
            />
          </div>

          <div>
            <label
              for="edit-description"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Description</label
            >
            <input
              type="text"
              id="edit-description"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              required
            />
          </div>

          <div>
            <label
              for="edit-category"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Category</label
            >
            <select
              id="edit-category"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              required
            >
              <!-- Options will be populated dynamically -->
            </select>
          </div>

          <div>
            <label
              for="edit-date"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Date</label
            >
            <input
              type="date"
              id="edit-date"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary"
              required
            />
          </div>

          <div class="flex justify-between pt-4">
            <button
              type="button"
              id="cancel-edit"
              class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition"
            >
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // DOM Elements
      const budgetForm = document.getElementById("budget-form");
      const editForm = document.getElementById("edit-form");
      const budgetItemsList = document.getElementById("budget-items-list");
      const emptyState = document.getElementById("empty-state");
      const totalIncomeElement = document.getElementById("total-income");
      const totalExpensesElement = document.getElementById("total-expenses");
      const remainingBudgetElement =
        document.getElementById("remaining-budget");
      const budgetProgress = document.getElementById("budget-progress");
      const budgetStatus = document.getElementById("budget-status");
      const filterType = document.getElementById("filter-type");
      const filterCategory = document.getElementById("filter-category");
      const clearFiltersBtn = document.getElementById("clear-filters");
      const editModal = document.getElementById("edit-modal");
      const cancelEditBtn = document.getElementById("cancel-edit");
      const currentMonthElement = document.getElementById("current-month");
      const prevMonthBtn = document.getElementById("prev-month");
      const nextMonthBtn = document.getElementById("next-month");

      // Chart instances
      let comparisonChart = null;
      let expensesChart = null;

      // Current date
      let currentDate = new Date();
      let currentMonth = currentDate.getMonth();
      let currentYear = currentDate.getFullYear();

      // Sample data for demonstration
      let budgetItems = JSON.parse(localStorage.getItem("budgetItems")) || [];

      // Initialize the app
      function initApp() {
        // Set today's date as default for the date input
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("date").value = today;

        // Update month display
        updateMonthDisplay();

        // Render budget items
        renderBudgetItems();
        updateSummary();
        renderCharts();
        populateCategoryFilter();

        // Add event listeners
        budgetForm.addEventListener("submit", addBudgetItem);
        editForm.addEventListener("submit", saveEditedItem);
        filterType.addEventListener("change", renderBudgetItems);
        filterCategory.addEventListener("change", renderBudgetItems);
        clearFiltersBtn.addEventListener("click", clearFilters);
        cancelEditBtn.addEventListener("click", closeEditModal);
        prevMonthBtn.addEventListener("click", goToPrevMonth);
        nextMonthBtn.addEventListener("click", goToNextMonth);

        // Show/hide categories based on type selection
        document.querySelectorAll('input[name="type"]').forEach((radio) => {
          radio.addEventListener("change", toggleCategoryOptions);
        });
      }

      // Update month display
      function updateMonthDisplay() {
        const monthNames = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        currentMonthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;

        // Re-render items for the selected month
        renderBudgetItems();
        updateSummary();
        renderCharts();
      }

      // Go to previous month
      function goToPrevMonth() {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        updateMonthDisplay();
      }

      // Go to next month
      function goToNextMonth() {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        updateMonthDisplay();
      }

      // Toggle category options based on type selection
      function toggleCategoryOptions() {
        const type = document.querySelector('input[name="type"]:checked').value;
        const categorySelect = document.getElementById("category");

        // Hide all options first
        Array.from(categorySelect.options).forEach((option) => {
          option.style.display = "none";
        });

        // Show relevant options
        if (type === "income") {
          Array.from(categorySelect.options).forEach((option) => {
            if (option.parentElement.label === "Income") {
              option.style.display = "block";
            }
          });
          // Select first income option
          categorySelect.value = "salary";
        } else {
          Array.from(categorySelect.options).forEach((option) => {
            if (option.parentElement.label === "Expenses") {
              option.style.display = "block";
            }
          });
          // Select first expense option
          categorySelect.value = "housing";
        }
      }

      // Add new budget item
      function addBudgetItem(e) {
        e.preventDefault();

        const type = document.querySelector('input[name="type"]:checked').value;
        const amount = parseFloat(document.getElementById("amount").value);
        const description = document.getElementById("description").value;
        const category = document.getElementById("category").value;
        const date = document.getElementById("date").value;
        const id = Date.now().toString();

        const budgetItem = {
          id,
          type,
          amount,
          description,
          category,
          date,
        };

        budgetItems.push(budgetItem);
        saveToLocalStorage();
        renderBudgetItems();
        updateSummary();
        renderCharts();

        // Reset form
        budgetForm.reset();
        document.getElementById("date").value = new Date()
          .toISOString()
          .split("T")[0];
        toggleCategoryOptions();
      }

      // Render budget items list
      function renderBudgetItems() {
        const typeFilter = filterType.value;
        const categoryFilter = filterCategory.value;

        // Filter budget items
        let filteredItems = budgetItems.filter((item) => {
          const itemDate = new Date(item.date);
          return (
            itemDate.getMonth() === currentMonth &&
            itemDate.getFullYear() === currentYear
          );
        });

        if (typeFilter !== "all") {
          filteredItems = filteredItems.filter(
            (item) => item.type === typeFilter
          );
        }

        if (categoryFilter !== "all") {
          filteredItems = filteredItems.filter(
            (item) => item.category === categoryFilter
          );
        }

        // Sort by date (newest first)
        filteredItems.sort((a, b) => new Date(b.date) - new Date(a.date));

        // Render budget items
        if (filteredItems.length === 0) {
          budgetItemsList.innerHTML = "";
          budgetItemsList.appendChild(emptyState);
          emptyState.classList.remove("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        budgetItemsList.innerHTML = "";

        filteredItems.forEach((item) => {
          const itemElement = document.createElement("div");
          itemElement.className = `budget-item bg-white border border-gray-200 rounded-lg p-4 ${
            item.type === "income"
              ? "border-l-4 border-l-green-500"
              : "border-l-4 border-l-red-500"
          }`;
          itemElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-medium text-gray-800">${
                              item.description
                            }</h3>
                            <div class="flex items-center mt-1">
                                <span class="text-gray-500 text-sm">${formatDate(
                                  item.date
                                )}</span>
                                <span class="mx-2 text-gray-300">•</span>
                                <span class="category-badge bg-${getCategoryColor(
                                  item.category
                                )}-100 text-${getCategoryColor(
            item.category
          )}-800">${getCategoryName(item.category)}</span>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg font-bold ${
                              item.type === "income"
                                ? "text-green-600"
                                : "text-red-600"
                            } mr-2">${
            item.type === "income" ? "+" : "-"
          }₹${item.amount.toFixed(2)}</span>
                            <button class="edit-btn text-blue-500 hover:text-blue-700" data-id="${
                              item.id
                            }">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-btn text-red-500 hover:text-red-700 ml-2" data-id="${
                              item.id
                            }">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
          budgetItemsList.appendChild(itemElement);
        });

        // Add event listeners to edit and delete buttons
        document.querySelectorAll(".edit-btn").forEach((btn) => {
          btn.addEventListener("click", () => openEditModal(btn.dataset.id));
        });

        document.querySelectorAll(".delete-btn").forEach((btn) => {
          btn.addEventListener("click", () => deleteBudgetItem(btn.dataset.id));
        });
      }

      // Update summary
      function updateSummary() {
        // Filter items for current month
        const currentMonthItems = budgetItems.filter((item) => {
          const itemDate = new Date(item.date);
          return (
            itemDate.getMonth() === currentMonth &&
            itemDate.getFullYear() === currentYear
          );
        });

        // Calculate total income
        const totalIncome = currentMonthItems
          .filter((item) => item.type === "income")
          .reduce((sum, item) => sum + item.amount, 0);

        // Calculate total expenses
        const totalExpenses = currentMonthItems
          .filter((item) => item.type === "expense")
          .reduce((sum, item) => sum + item.amount, 0);

        // Calculate remaining budget
        const remainingBudget = totalIncome - totalExpenses;

        // Calculate percentage of income remaining
        const percentageRemaining =
          totalIncome > 0 ? (remainingBudget / totalIncome) * 100 : 0;

        // Update UI
        totalIncomeElement.textContent = `₹${totalIncome.toFixed(2)}`;
        totalExpensesElement.textContent = `₹${totalExpenses.toFixed(2)}`;
        remainingBudgetElement.textContent = `₹${remainingBudget.toFixed(2)}`;
        budgetProgress.style.width = `${percentageRemaining}%`;

        // Set progress bar color based on percentage
        if (percentageRemaining > 50) {
          budgetProgress.className =
            "h-2.5 rounded-full progress-bar bg-green-500";
        } else if (percentageRemaining > 20) {
          budgetProgress.className =
            "h-2.5 rounded-full progress-bar bg-yellow-500";
        } else {
          budgetProgress.className =
            "h-2.5 rounded-full progress-bar bg-red-500";
        }

        // Update status text
        budgetStatus.textContent = `${percentageRemaining.toFixed(
          0
        )}% of income remaining`;
      }

      // Render charts
      function renderCharts() {
        renderComparisonChart();
        renderExpensesChart();
      }

      // Render comparison chart
      function renderComparisonChart() {
        const ctx = document
          .getElementById("comparison-chart")
          .getContext("2d");

        // Filter items for current month
        const currentMonthItems = budgetItems.filter((item) => {
          const itemDate = new Date(item.date);
          return (
            itemDate.getMonth() === currentMonth &&
            itemDate.getFullYear() === currentYear
          );
        });

        // Calculate total income and expenses
        const totalIncome = currentMonthItems
          .filter((item) => item.type === "income")
          .reduce((sum, item) => sum + item.amount, 0);

        const totalExpenses = currentMonthItems
          .filter((item) => item.type === "expense")
          .reduce((sum, item) => sum + item.amount, 0);

        // Destroy previous chart if it exists
        if (comparisonChart) {
          comparisonChart.destroy();
        }

        // Create new chart
        comparisonChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["Income", "Expenses"],
            datasets: [
              {
                label: "Amount (₹)",
                data: [totalIncome, totalExpenses],
                backgroundColor: ["#10B981", "#EF4444"],
                borderRadius: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  drawBorder: false,
                },
              },
              x: {
                grid: {
                  display: false,
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
            },
          },
        });
      }

      // Render expenses chart
      function renderExpensesChart() {
        const ctx = document.getElementById("expenses-chart").getContext("2d");

        // Filter expense items for current month
        const currentMonthExpenses = budgetItems.filter((item) => {
          const itemDate = new Date(item.date);
          return (
            item.type === "expense" &&
            itemDate.getMonth() === currentMonth &&
            itemDate.getFullYear() === currentYear
          );
        });

        // Calculate totals by category
        const categoryTotals = {};
        currentMonthExpenses.forEach((item) => {
          if (!categoryTotals[item.category]) {
            categoryTotals[item.category] = 0;
          }
          categoryTotals[item.category] += item.amount;
        });

        // Prepare data for chart
        const categories = Object.keys(categoryTotals);
        const amounts = Object.values(categoryTotals);

        // Destroy previous chart if it exists
        if (expensesChart) {
          expensesChart.destroy();
        }

        // Create new chart
        expensesChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: categories.map((category) => getCategoryName(category)),
            datasets: [
              {
                data: amounts,
                backgroundColor: [
                  "#3B82F6",
                  "#10B981",
                  "#6366F1",
                  "#F59E0B",
                  "#EF4444",
                  "#8B5CF6",
                  "#EC4899",
                  "#6B7280",
                  "#84CC16",
                ],
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  boxWidth: 12,
                  padding: 15,
                },
              },
            },
          },
        });
      }

      // Populate category filter
      function populateCategoryFilter() {
        // Clear existing options
        filterCategory.innerHTML =
          '<option value="all">All Categories</option>';

        // Add income categories
        const incomeCategories = document.getElementById("income-categories");
        Array.from(incomeCategories.options).forEach((option) => {
          const newOption = document.createElement("option");
          newOption.value = option.value;
          newOption.textContent = option.textContent;
          filterCategory.appendChild(newOption);
        });

        // Add expense categories
        const expenseCategories = document.getElementById("expense-categories");
        Array.from(expenseCategories.options).forEach((option) => {
          const newOption = document.createElement("option");
          newOption.value = option.value;
          newOption.textContent = option.textContent;
          filterCategory.appendChild(newOption);
        });
      }

      // Open edit modal
      function openEditModal(id) {
        const item = budgetItems.find((item) => item.id === id);

        if (item) {
          document.getElementById("edit-id").value = item.id;
          document.querySelector(
            `input[name="edit-type"][value="${item.type}"]`
          ).checked = true;
          document.getElementById("edit-amount").value = item.amount;
          document.getElementById("edit-description").value = item.description;
          document.getElementById("edit-date").value = item.date;

          // Populate category options based on type
          const editCategorySelect = document.getElementById("edit-category");
          editCategorySelect.innerHTML = "";

          if (item.type === "income") {
            const incomeCategories =
              document.getElementById("income-categories");
            Array.from(incomeCategories.options).forEach((option) => {
              const newOption = document.createElement("option");
              newOption.value = option.value;
              newOption.textContent = option.textContent;
              if (option.value === item.category) {
                newOption.selected = true;
              }
              editCategorySelect.appendChild(newOption);
            });
          } else {
            const expenseCategories =
              document.getElementById("expense-categories");
            Array.from(expenseCategories.options).forEach((option) => {
              const newOption = document.createElement("option");
              newOption.value = option.value;
              newOption.textContent = option.textContent;
              if (option.value === item.category) {
                newOption.selected = true;
              }
              editCategorySelect.appendChild(newOption);
            });
          }

          editModal.classList.remove("hidden");
        }
      }

      // Close edit modal
      function closeEditModal() {
        editModal.classList.add("hidden");
      }

      // Save edited item
      function saveEditedItem(e) {
        e.preventDefault();

        const id = document.getElementById("edit-id").value;
        const type = document.querySelector(
          'input[name="edit-type"]:checked'
        ).value;
        const amount = parseFloat(document.getElementById("edit-amount").value);
        const description = document.getElementById("edit-description").value;
        const category = document.getElementById("edit-category").value;
        const date = document.getElementById("edit-date").value;

        const index = budgetItems.findIndex((item) => item.id === id);

        if (index !== -1) {
          budgetItems[index] = {
            ...budgetItems[index],
            type,
            amount,
            description,
            category,
            date,
          };

          saveToLocalStorage();
          renderBudgetItems();
          updateSummary();
          renderCharts();
          closeEditModal();
        }
      }

      // Delete budget item
      function deleteBudgetItem(id) {
        if (confirm("Are you sure you want to delete this item?")) {
          budgetItems = budgetItems.filter((item) => item.id !== id);
          saveToLocalStorage();
          renderBudgetItems();
          updateSummary();
          renderCharts();
        }
      }

      // Clear filters
      function clearFilters() {
        filterType.value = "all";
        filterCategory.value = "all";
        renderBudgetItems();
      }

      // Save to localStorage
      function saveToLocalStorage() {
        localStorage.setItem("budgetItems", JSON.stringify(budgetItems));
      }

      // Helper function to format date
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      // Helper function to get category name
      function getCategoryName(category) {
        const categoryNames = {
          // Income categories
          salary: "Salary",
          freelance: "Freelance Work",
          investment: "Investment Returns",
          gift: "Gifts",
          "other-income": "Other Income",
          // Expense categories
          housing: "Housing",
          utilities: "Utilities",
          food: "Food & Dining",
          transport: "Transportation",
          health: "Health & Fitness",
          entertainment: "Entertainment",
          shopping: "Shopping",
          debt: "Debt Payments",
          "other-expense": "Other Expenses",
        };

        return categoryNames[category] || "Other";
      }

      // Helper function to get category color
      function getCategoryColor(category) {
        const categoryColors = {
          // Income categories
          salary: "green",
          freelance: "blue",
          investment: "purple",
          gift: "pink",
          "other-income": "gray",
          // Expense categories
          housing: "red",
          utilities: "yellow",
          food: "orange",
          transport: "blue",
          health: "green",
          entertainment: "purple",
          shopping: "pink",
          debt: "red",
          "other-expense": "gray",
        };

        return categoryColors[category] || "gray";
      }

      // Initialize the app
      initApp();
    </script>
  </body>
</html>