<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Photo Colorizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>

  <body class="bg-gray-100 min-h-screen">
    <?php include 'includes/navbar.html'; ?>
    <nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>
    <div class="container mx-auto px-4 py-12">
      <div
        class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden p-6"
      >
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">
          Photo Colorizer
        </h1>
        <p class="text-center text-gray-600 mb-8">
          Upload a black & white photo and apply AI-powered colorization
        </p>

        <div class="flex flex-col md:flex-row gap-8">
          <!-- Upload Section -->
          <div class="w-full md:w-1/2">
            <div
              id="drop-area"
              class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-50 transition h-64 flex flex-col items-center justify-center"
            >
              <input
                type="file"
                id="fileInput"
                accept="image/*"
                class="hidden"
              />
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-blue-500 mb-3"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                />
              </svg>
              <p class="text-lg font-medium text-gray-700">
                Drag & drop photo here
              </p>
              <p class="text-gray-500 mt-1">or click to browse files</p>
              <p class="text-sm text-gray-400 mt-2">Supports JPG, PNG, WEBP</p>
            </div>

            <div id="original-preview" class="mt-4 hidden">
              <h3 class="text-lg font-semibold text-gray-700 mb-2">
                Original Photo
              </h3>
              <img
                id="original-image"
                class="max-w-full rounded-lg border border-gray-200"
                alt="Original photo"
              />
            </div>
          </div>

          <!-- Result Section -->
          <div class="w-full md:w-1/2">
            <div
              id="result-placeholder"
              class="border-2 border-dashed border-gray-200 rounded-lg p-6 text-center h-64 flex flex-col items-center justify-center bg-gray-50"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-gray-300 mb-3"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              <p class="text-gray-400">Colorized result will appear here</p>
            </div>

            <div id="result-preview" class="mt-4 hidden">
              <h3 class="text-lg font-semibold text-gray-700 mb-2">
                Colorized Photo
              </h3>
              <img
                id="colorized-image"
                class="max-w-full rounded-lg border border-gray-200"
                alt="Colorized photo"
              />
            </div>
          </div>
        </div>

        <!-- Controls -->
        <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
          <button
            id="colorize-btn"
            class="px-6 py-3 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled
          >
            Colorize Photo
          </button>
          <button
            id="download-btn"
            class="px-6 py-3 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 hidden"
          >
            Download Result
          </button>
          <button
            id="reset-btn"
            class="px-6 py-3 bg-gray-200 text-gray-700 font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 hidden"
          >
            Reset
          </button>
        </div>

        <!-- Color Adjustment Controls (shown after colorization) -->
        <div id="adjustment-controls" class="mt-6 hidden">
          <h3 class="text-lg font-semibold text-gray-700 mb-3">
            Color Adjustments
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label
                for="saturation"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Saturation</label
              >
              <input
                type="range"
                id="saturation"
                min="0"
                max="200"
                value="100"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              />
            </div>
            <div>
              <label
                for="contrast"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Contrast</label
              >
              <input
                type="range"
                id="contrast"
                min="0"
                max="200"
                value="100"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              />
            </div>
            <div>
              <label
                for="brightness"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Brightness</label
              >
              <input
                type="range"
                id="brightness"
                min="0"
                max="200"
                value="100"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              />
            </div>
            <div>
              <label
                for="temperature"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Temperature</label
              >
              <input
                type="range"
                id="temperature"
                min="-100"
                max="100"
                value="0"
                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
              />
            </div>
          </div>
        </div>

        <!-- Loading Indicator -->
        <div
          id="loading"
          class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
        >
          <div
            class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full text-center"
          >
            <div
              class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"
            ></div>
            <p class="text-lg font-medium text-gray-800">Colorizing Photo...</p>
            <p class="text-gray-600 mt-1">This may take 10-30 seconds</p>
            <p id="progress-text" class="text-sm text-blue-600 mt-2"></p>
          </div>
        </div>
      </div>
    </div>
    <?php include 'includes/footer.html'; ?>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Elements
        const fileInput = document.getElementById("fileInput");
        const dropArea = document.getElementById("drop-area");
        const originalPreview = document.getElementById("original-preview");
        const originalImage = document.getElementById("original-image");
        const resultPlaceholder = document.getElementById("result-placeholder");
        const resultPreview = document.getElementById("result-preview");
        const colorizedImage = document.getElementById("colorized-image");
        const colorizeBtn = document.getElementById("colorize-btn");
        const downloadBtn = document.getElementById("download-btn");
        const resetBtn = document.getElementById("reset-btn");
        const loading = document.getElementById("loading");
        const progressText = document.getElementById("progress-text");
        const adjustmentControls = document.getElementById(
          "adjustment-controls"
        );

        // Color adjustment controls
        const saturationControl = document.getElementById("saturation");
        const contrastControl = document.getElementById("contrast");
        const brightnessControl = document.getElementById("brightness");
        const temperatureControl = document.getElementById("temperature");

        let originalImageData = null;
        let colorizedImageData = null;
        let canvas = document.createElement("canvas");
        let ctx = canvas.getContext("2d");

        // Set up drag and drop
        ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
          dropArea.addEventListener(eventName, preventDefaults, false);
          document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ["dragenter", "dragover"].forEach((eventName) => {
          dropArea.addEventListener(eventName, highlight, false);
        });

        ["dragleave", "drop"].forEach((eventName) => {
          dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
          dropArea.classList.add("border-blue-400", "bg-blue-50");
        }

        function unhighlight() {
          dropArea.classList.remove("border-blue-400", "bg-blue-50");
        }

        dropArea.addEventListener("drop", handleDrop, false);
        dropArea.addEventListener("click", () => fileInput.click());
        fileInput.addEventListener("change", handleFileSelect);

        // Handle file selection
        function handleFileSelect(e) {
          const files = e.target.files || e.dataTransfer.files;
          if (files.length > 0) {
            processImage(files[0]);
          }
        }

        function handleDrop(e) {
          const dt = e.dataTransfer;
          const files = dt.files;
          if (files.length > 0) {
            processImage(files[0]);
          }
        }

        // Process the selected image
        function processImage(file) {
          if (!file.type.match("image.*")) {
            alert("Please select an image file.");
            return;
          }

          const reader = new FileReader();
          reader.onload = function (e) {
            originalImage.src = e.target.result;
            originalPreview.classList.remove("hidden");
            colorizeBtn.disabled = false;
            resultPlaceholder.classList.add("hidden");
            resultPreview.classList.add("hidden");
            downloadBtn.classList.add("hidden");
            resetBtn.classList.add("hidden");
            adjustmentControls.classList.add("hidden");

            // Store original image data
            originalImage.onload = function () {
              canvas.width = originalImage.naturalWidth;
              canvas.height = originalImage.naturalHeight;
              ctx.drawImage(originalImage, 0, 0);
              originalImageData = ctx.getImageData(
                0,
                0,
                canvas.width,
                canvas.height
              );
            };
          };
          reader.readAsDataURL(file);
        }

        // Colorize button click handler
        colorizeBtn.addEventListener("click", function () {
          if (!originalImageData) return;

          loading.classList.remove("hidden");
          colorizeBtn.disabled = true;
          progressText.textContent = "Initializing colorization...";

          // Simulate AI processing (in a real app, you would call an API here)
          simulateColorization();
        });

        // Simulate the colorization process
        function simulateColorization() {
          // This is where you would normally call a colorization API
          // For this demo, we'll simulate the API call with timeouts

          progressText.textContent = "Analyzing image...";
          setTimeout(() => {
            progressText.textContent = "Detecting image features...";
            setTimeout(() => {
              progressText.textContent = "Applying colorization...";
              setTimeout(() => {
                // For demo purposes, we'll just apply a filter to simulate colorization
                // In a real app, you would receive the colorized image from an API
                applyDemoColorization();

                loading.classList.add("hidden");
                colorizeBtn.disabled = false;

                // Show result
                resultPreview.classList.remove("hidden");
                downloadBtn.classList.remove("hidden");
                resetBtn.classList.remove("hidden");
                adjustmentControls.classList.remove("hidden");
              }, 2000);
            }, 2000);
          }, 2000);
        }

        // Demo colorization effect (simulates real colorization)
        function applyDemoColorization() {
          canvas.width = originalImage.naturalWidth;
          canvas.height = originalImage.naturalHeight;
          ctx.drawImage(originalImage, 0, 0);

          // Apply some color effects to simulate AI colorization
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;

          // Simple colorization algorithm for demo purposes
          for (let i = 0; i < data.length; i += 4) {
            // Convert grayscale to sepia-like tones
            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;

            // Apply different color channels based on brightness
            if (avg < 85) {
              // Dark areas - blueish
              data[i] = avg * 0.8; // R
              data[i + 1] = avg * 0.6; // G
              data[i + 2] = avg * 1.2; // B
            } else if (avg < 170) {
              // Mid tones - warm colors
              data[i] = avg * 1.2; // R
              data[i + 1] = avg * 0.9; // G
              data[i + 2] = avg * 0.6; // B
            } else {
              // Bright areas - yellowish
              data[i] = avg * 1.3; // R
              data[i + 1] = avg * 1.2; // G
              data[i + 2] = avg * 0.7; // B
            }
          }

          ctx.putImageData(imageData, 0, 0);
          colorizedImage.src = canvas.toDataURL("image/jpeg");
          colorizedImageData = imageData;

          // Apply initial adjustments
          updateColorAdjustments();
        }

        // Reset button handler
        resetBtn.addEventListener("click", function () {
          originalPreview.classList.add("hidden");
          resultPreview.classList.add("hidden");
          downloadBtn.classList.add("hidden");
          resetBtn.classList.add("hidden");
          adjustmentControls.classList.add("hidden");
          resultPlaceholder.classList.remove("hidden");
          colorizeBtn.disabled = true;
          fileInput.value = "";
        });

        // Download button handler
        downloadBtn.addEventListener("click", function () {
          if (!colorizedImage.src) return;

          const link = document.createElement("a");
          link.href = colorizedImage.src;
          link.download = "colorized-photo.jpg";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        });

        // Color adjustment handlers
        saturationControl.addEventListener("input", updateColorAdjustments);
        contrastControl.addEventListener("input", updateColorAdjustments);
        brightnessControl.addEventListener("input", updateColorAdjustments);
        temperatureControl.addEventListener("input", updateColorAdjustments);

        // Update image with current adjustments
        function updateColorAdjustments() {
          if (!colorizedImageData) return;

          // Create a copy of the original colorized data
          const adjustedData = new ImageData(
            new Uint8ClampedArray(colorizedImageData.data),
            colorizedImageData.width,
            colorizedImageData.height
          );

          const data = adjustedData.data;
          const saturation = saturationControl.value / 100;
          const contrast = contrastControl.value / 100;
          const brightness = brightnessControl.value / 100;
          const temperature = temperatureControl.value / 100;

          // Apply adjustments
          for (let i = 0; i < data.length; i += 4) {
            // Brightness
            data[i] = data[i] * brightness;
            data[i + 1] = data[i + 1] * brightness;
            data[i + 2] = data[i + 2] * brightness;

            // Contrast
            const factor =
              (259 * (contrast * 100 + 255)) / (255 * (259 - contrast * 100));
            data[i] = factor * (data[i] - 128) + 128;
            data[i + 1] = factor * (data[i + 1] - 128) + 128;
            data[i + 2] = factor * (data[i + 2] - 128) + 128;

            // Saturation
            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
            data[i] = avg + saturation * (data[i] - avg);
            data[i + 1] = avg + saturation * (data[i + 1] - avg);
            data[i + 2] = avg + saturation * (data[i + 2] - avg);

            // Temperature (warm/cool)
            if (temperature > 0) {
              // Warm (add red, reduce blue)
              data[i] = data[i] * (1 + temperature);
              data[i + 2] = data[i + 2] * (1 - temperature);
            } else {
              // Cool (add blue, reduce red)
              data[i] = data[i] * (1 + temperature);
              data[i + 2] = data[i + 2] * (1 - temperature);
            }

            // Clamp values to 0-255
            data[i] = Math.max(0, Math.min(255, data[i]));
            data[i + 1] = Math.max(0, Math.min(255, data[i + 1]));
            data[i + 2] = Math.max(0, Math.min(255, data[i + 2]));
          }

          // Apply to canvas and update image
          ctx.putImageData(adjustedData, 0, 0);
          colorizedImage.src = canvas.toDataURL("image/jpeg");
        }
      });
    </script>
  </body>
</html>
