<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF to JPG Converter</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- PDF.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #fff;
        min-height: 100vh;
        overflow-x: hidden;
      }

      .drop-zone {
        border: 3px dashed #93c5fd;
        border-radius: 16px;
        padding: 2.5rem;
        text-align: center;
        background: #eef2ff;
        transition: all 0.3s ease;
      }

      .drop-zone.dragover {
        border-color: #2563eb;
        background: #dbeafe;
        transform: scale(1.02);
      }

      .preview-box {
        background: white;
        border-radius: 16px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-top: 1.5rem;
        display: none;
      }

      #pdfPreview {
        width: 100%;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        overflow: hidden;
        margin-top: 1rem;
      }

      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .preview-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
      }

      .preview-close {
        cursor: pointer;
        color: #6b7280;
        transition: color 0.2s;
      }

      .preview-close:hover {
        color: #ef4444;
      }

      .action-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
        justify-content: center;
      }

      .loading-spinner {
        display: inline-block;
        width: 1.5rem;
        height: 1.5rem;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 0.5rem;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .progress-container {
        width: 100%;
        background-color: #e5e7eb;
        border-radius: 9999px;
        margin: 1rem 0;
        height: 0.5rem;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background-color: #3b82f6;
        width: 0%;
        transition: width 0.3s ease;
      }

      .status-message {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: 0.5rem;
        display: none;
      }

      .status-success {
        background-color: #ecfdf5;
        color: #065f46;
        border: 1px solid #a7f3d0;
      }

      .status-error {
        background-color: #fef2f2;
        color: #b91c1c;
        border: 1px solid #fecaca;
      }

      .status-info {
        background-color: #eff6ff;
        color: #1e40af;
        border: 1px solid #bfdbfe;
      }

      @media (max-width: 640px) {
        .container {
          padding: 1rem;
        }

        .drop-zone {
          padding: 1.5rem;
        }

        .action-buttons {
          flex-direction: column;
        }

        button {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <?php include 'includes/navbar.html'; ?>
    <nav class="bg-white shadow-md py-4">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="/" class="flex items-center">
            <i
              class="fas fa-image text-2xl sm:text-3xl text-blue-800 mr-2 sm:mr-3"
            ></i>
            <span
              class="text-xl sm:text-2xl font-bold text-blue-800 hidden sm:inline"
              >ImgFlow</span
            >
          </a>
        </div>
        <div class="flex items-center">
          <a
            href="/"
            class="bg-blue-600 text-white px-3 py-2 sm:px-4 sm:py-2 rounded-md hover:bg-blue-700 transition-colors duration-200 flex items-center text-sm sm:text-base"
          >
            <i class="fas fa-home mr-1 sm:mr-2"></i> Back to Home
          </a>
        </div>
      </div>
    </nav>
    <div class="container mt-10">
      <h1
        class="text-5xl font-extrabold text-center text-black mt-5 mb-4 sm:text-3xl"
      >
        PDF to JPG Converter
      </h1>
      <p class="text-xl text-center text-gray-500 mb-10 sm:text-xl">
        The PDF to JPG Converter helps you extract and convert each page of a<br />
        PDF file into high-quality JPG images.
      </p>

      <!-- Drop Zone -->
      <div
        class="drop-zone max-w-3xl mx-auto"
        id="dropZone"
        style="min-height: 300px"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-12 w-12 mx-auto text-indigo-500"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
          />
        </svg>
        <p class="text-gray-700 text-xl font-medium sm:text-base mt-3">
          Drop your PDF here or
        </p>
        <input type="file" id="pdfInput" accept=".pdf" class="hidden" />
        <button
          id="selectFileBtn"
          class="mt-4 px-6 py-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition text-base sm:text-sm shadow-md"
        >
          Select PDF File
        </button>
        <p class="text-gray-500 text-sm mt-3">Supports PDF documents</p>
      </div>

      <!-- Progress Bar -->
      <div
        id="progressContainer"
        class="progress-container hidden max-w-3xl mx-auto"
      >
        <div id="progressBar" class="progress-bar"></div>
      </div>

      <!-- Status Message -->
      <div id="statusMessage" class="status-message"></div>

      <!-- Preview Box -->
      <div class="preview-box max-w-3xl mx-auto" id="previewBox">
        <div class="preview-header">
          <h3 class="preview-title">PDF Preview</h3>
          <span class="preview-close" id="closePreview">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </span>
        </div>
        <div id="pdfPreview"></div>

        <div class="action-buttons">
          <button
            id="convertBtn"
            class="px-6 py-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition text-base sm:text-sm shadow-md flex items-center justify-center gap-2"
            disabled
          >
            <span id="convertBtnText">Convert to JPG</span>
          </button>
        </div>
      </div>
    </div>
    <div class="container mt-10 mb-10">
      <!-- Step-by-Step Guide -->
      <div class="text-center mb-10">
        <h2 class="text-3xl font-bold text-black mb-4">
          How To Convert a PDF to JPG Images
        </h2>
        <p class="text-gray-500 mb-6">follow along with the steps below</p>
        <div class="flex justify-center space-x-8">
          <div class="text-center">
            <div
              class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-2"
            >
              <svg
                class="w-8 h-8 text-indigo-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                ></path>
              </svg>
            </div>
            <p class="text-sm font-medium text-gray-700">Step 1</p>
            <p class="text-gray-500">
              Select a PDF document to convert to JPG format
            </p>
          </div>
          <div class="text-center">
            <div
              class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-2"
            >
              <svg
                class="w-8 h-8 text-indigo-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                ></path>
              </svg>
            </div>
            <p class="text-sm font-medium text-gray-700">Step 2</p>
            <p class="text-gray-500">
              Upload the PDF file from a Mac or PC, Android or iPhone
            </p>
          </div>
          <div class="text-center">
            <div
              class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-2"
            >
              <svg
                class="w-8 h-8 text-indigo-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                ></path>
              </svg>
            </div>
            <p class="text-sm font-medium text-gray-700">Step 3</p>
            <p class="text-gray-500">Download the converted JPG image</p>
          </div>
        </div>
      </div>
    </div>
    <?php include 'includes/footer.html'; ?>
    <script>
      // Initialize PDF.js worker
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js";

      document.addEventListener("DOMContentLoaded", function () {
        // DOM elements
        const dropZone = document.getElementById("dropZone");
        const pdfInput = document.getElementById("pdfInput");
        const selectFileBtn = document.getElementById("selectFileBtn");
        const convertBtn = document.getElementById("convertBtn");
        const convertBtnText = document.getElementById("convertBtnText");
        const previewBox = document.getElementById("previewBox");
        const pdfPreview = document.getElementById("pdfPreview");
        const closePreview = document.getElementById("closePreview");
        const statusMessage = document.getElementById("statusMessage");
        const progressContainer = document.getElementById("progressContainer");
        const progressBar = document.getElementById("progressBar");

        // State variables
        let pdfDocument = null;
        let pdfFile = null;
        let isProcessing = false;

        // Event listeners
        selectFileBtn.addEventListener("click", () => pdfInput.click());
        pdfInput.addEventListener("change", handleFileSelect);
        convertBtn.addEventListener("click", convertToJpg);
        closePreview.addEventListener("click", hidePreview);

        // Drag and drop events
        dropZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          dropZone.classList.add("dragover");
        });

        dropZone.addEventListener("dragleave", () => {
          dropZone.classList.remove("dragover");
        });

        dropZone.addEventListener("drop", (e) => {
          e.preventDefault();
          dropZone.classList.remove("dragover");

          if (e.dataTransfer.files.length) {
            pdfInput.files = e.dataTransfer.files;
            handleFileSelect({ target: pdfInput });
          }
        });

        // Handle file selection
        async function handleFileSelect(event) {
          const file = event.target.files[0];

          if (
            !file ||
            !(
              file.type === "application/pdf" ||
              file.name.toLowerCase().endsWith(".pdf")
            )
          ) {
            showStatus("Please select a valid PDF file.", "error");
            return;
          }

          pdfFile = file;
          isProcessing = true;
          showStatus("Loading PDF document...", "info");
          convertBtn.disabled = true;
          convertBtnText.innerHTML =
            '<span class="loading-spinner"></span> Loading PDF...';

          try {
            const arrayBuffer = await readFileAsArrayBuffer(file);
            pdfDocument = await pdfjsLib.getDocument({ data: arrayBuffer })
              .promise;

            showStatus("PDF loaded successfully. Ready to convert.", "success");
            convertBtn.disabled = false;
            convertBtnText.innerHTML =
              '<i class="fas fa-image"></i> Convert to JPG';
            showPreview();
          } catch (error) {
            console.error("Error loading PDF:", error);
            showStatus(`Error loading PDF: ${error.message}`, "error");
            convertBtnText.innerHTML =
              '<i class="fas fa-image"></i> Convert to JPG';
          } finally {
            isProcessing = false;
          }
        }

        // Show PDF preview
        async function showPreview() {
          if (!pdfDocument) return;

          dropZone.style.display = "none";
          previewBox.style.display = "block";
          pdfPreview.innerHTML =
            '<p class="text-center py-10 text-gray-500">Loading PDF preview...</p>';

          try {
            const page = await pdfDocument.getPage(1);
            const viewport = page.getViewport({ scale: 1.0 });
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            pdfPreview.innerHTML = "";
            pdfPreview.appendChild(canvas);

            await page.render({
              canvasContext: context,
              viewport: viewport,
            }).promise;
          } catch (error) {
            pdfPreview.innerHTML = `<p class="text-center py-10 text-red-500">Error rendering PDF preview: ${error.message}</p>`;
          }
        }

        // Hide preview
        function hidePreview() {
          previewBox.style.display = "none";
          dropZone.style.display = "block";
          pdfDocument = null;
          pdfFile = null;
          pdfInput.value = "";
        }

        // Convert PDF to JPG
        async function convertToJpg() {
          if (!pdfDocument || !pdfFile || isProcessing) return;

          isProcessing = true;
          convertBtn.disabled = true;
          convertBtnText.innerHTML =
            '<span class="loading-spinner"></span> Processing...';
          progressContainer.classList.remove("hidden");
          progressBar.style.width = "0%";
          showStatus("Converting PDF pages to JPG images...", "info");

          try {
            const totalPages = pdfDocument.numPages;

            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
              // Update progress
              progressBar.style.width = `${(pageNum / totalPages) * 100}%`;
              showStatus(
                `Converting page ${pageNum} of ${totalPages}...`,
                "info"
              );

              const page = await pdfDocument.getPage(pageNum);
              const viewport = page.getViewport({ scale: 2.0 }); // Higher scale for better quality
              const canvas = document.createElement("canvas");
              const context = canvas.getContext("2d");
              canvas.height = viewport.height;
              canvas.width = viewport.width;

              await page.render({
                canvasContext: context,
                viewport: viewport,
              }).promise;

              // Convert canvas to JPG and download
              const imageUrl = canvas.toDataURL("image/jpeg", 0.9); // 0.9 quality
              const link = document.createElement("a");
              link.href = imageUrl;
              link.download =
                pdfFile.name.replace(".pdf", "") + `_page_${pageNum}.jpg`;
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
            }

            showStatus("All pages converted to JPG successfully!", "success");
          } catch (error) {
            console.error("Conversion error:", error);
            showStatus(`Error converting PDF: ${error.message}`, "error");
          } finally {
            isProcessing = false;
            convertBtn.disabled = false;
            convertBtnText.innerHTML =
              '<i class="fas fa-image"></i> Convert to JPG';
            progressContainer.classList.add("hidden");
          }
        }

        // Helper function to read file as ArrayBuffer
        function readFileAsArrayBuffer(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = () => reject(new Error("Failed to read file"));
            reader.readAsArrayBuffer(file);
          });
        }

        // Show status message
        function showStatus(message, type) {
          statusMessage.style.display = "block";
          statusMessage.textContent = message;
          statusMessage.className = "status-message";

          if (type === "success") {
            statusMessage.classList.add("status-success");
          } else if (type === "error") {
            statusMessage.classList.add("status-error");
          } else {
            statusMessage.classList.add("status-info");
          }
        }
      });
    </script>
  </body>
</html>
